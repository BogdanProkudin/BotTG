const POTICKTEXT = `–ü–æ–ª–∏—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö–¥–∞–Ω–Ω—ã—Ö


–ù–∞—Å—Ç–æ—è—â–∞—è –ü–æ–ª–∏—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–¥–∞–ª–µ–µ ‚Äì –ü–æ–ª–∏—Ç–∏–∫–∞) –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Å–∞–π—Ç—É —Å
–¥–æ–º–µ–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º florimondi.ru –∏ —á–∞—Ç –±–æ—Ç—É —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–º—É –Ω–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Ä–µ—Å—É—Ä—Å–µ Telegram Messenger –ø–æ –∞–¥—Ä–µ—Å—É @Flori_Mondi_Bot
(–¥–∞–ª–µ–µ ‚Äì –°–∞–π—Ç –∏ —á–∞—Ç –±–æ—Ç) –∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏–§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–∞ –æ—Ç 27.07.2006. ‚Ññ152-–§–ó ¬´–û –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö¬ª (–¥–∞–ª–µ–µ -
–ó–∞–∫–æ–Ω –æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö) —Å —Ü–µ–ª—å—é –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –º–µ—Ä –ø–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞–µ–º—ã—Ö –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º
–ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–º –ö–∞—Ä–ø—É–Ω–∏–Ω—ã–º –ê–Ω–¥—Ä–µ–µ–º –ê–Ω–∞—Ç–æ–ª—å–µ–≤–∏—á–µ–º –ò–ù–ù: 771971874638 –û–ì–†–ù–ò–ü:320774600392892 (–¥–∞–ª–µ–µ-–û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º)

 –ù–∞—Å—Ç–æ—è—â–∞—è –ü–æ–ª–∏—Ç–∏–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞ —Å —É—á–µ—Ç–æ–º
—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–∏ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏, –∞ —Ç–∞–∫–∂–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ó–∞–∫–æ–Ω–æ–º,–∏–Ω—ã–º–∏ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–º–∏ –∑–∞–∫–æ–Ω–∞–º–∏ –∏ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ –∞–∫—Ç–∞–º–∏ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏,
–æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–º–∏ –ø–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–∞–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Ü–µ–ª—è—Ö –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∑–∞—â–∏—Ç—ã –ø—Ä–∞–≤ –∏ —Å–≤–æ–±–æ–¥
—á–µ–ª–æ–≤–µ–∫–∞ –∏ –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º.
–ü–æ–ª–æ–∂–µ–Ω–∏—è –Ω–∞—Å—Ç–æ—è—â–µ–π –ü–æ–ª–∏—Ç–∏–∫–∏ —è–≤–ª—è—é—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–∞–º–∏ –û–ø–µ—Ä–∞—Ç–æ—Ä–∞,
–∏–º–µ—é—â–∏–º–∏ –¥–æ—Å—Ç—É–ø –∫ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º.
–ü–æ–ª–æ–∂–µ–Ω–∏—è –Ω–∞—Å—Ç–æ—è—â–µ–π –ü–æ–ª–∏—Ç–∏–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è –∏–∑–º–µ–Ω–µ–Ω—ã –û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –≤ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–º
–ø–æ—Ä—è–¥–∫–µ.
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–°–∞–π—Ç–∞ –∏ —á–∞—Ç –±–æ—Ç–∞ –ª–∏—Ü–∞–º–∏, –∏–º–µ—é—â–∏–º–∏ –¥–æ—Å—Ç—É–ø –∫ –°–∞–π—Ç—É –∏ —á–∞—Ç –±–æ—Ç—É, –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º —Å–µ—Ç–∏
–ò–Ω—Ç–µ—Ä–Ω–µ—Ç (–¥–∞–ª–µ–µ ‚Äì –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏) –æ–∑–Ω–∞—á–∞–µ—Ç —Å–æ–≥–ª–∞—Å–∏–µ —Å –Ω–∞—Å—Ç–æ—è—â–µ–π –ü–æ–ª–∏—Ç–∏–∫–æ–π –∏ —É—Å–ª–æ–≤–∏—è–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –í —Å–ª—É—á–∞–µ –Ω–µ—Å–æ–≥–ª–∞—Å–∏—è —Å
—É—Å–ª–æ–≤–∏—è–º–∏ –ü–æ–ª–∏—Ç–∏–∫–∏ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –°–∞–π—Ç–∞ –∏ —á–∞—Ç –±–æ—Ç–∞.


–ù–∞—Å—Ç–æ—è—â–∞—è
–ü–æ–ª–∏—Ç–∏–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –°–∞–π—Ç—É –∏ —á–∞—Ç –±–æ—Ç—É. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –°–∞–π—Ç–∞ –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∏ –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Å–∞–π—Ç—ã —Ç—Ä–µ—Ç—å–∏—Ö –ª–∏—Ü, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–∞–º, –¥–æ—Å—Ç—É–ø–Ω—ã–º –Ω–∞ –°–∞–π—Ç–µ.

1.–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –≤ —Ü–µ–ª—è—Ö:

¬∑
–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫ —Å–µ—Ä–≤–∏—Å–∞–º, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏/–∏–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º—Å—è –Ω–∞ –°–∞–π—Ç–µ.
¬∑
–ø—Ä–æ–¥–∞–∂–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥, –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –∫—É–ø–ª–∏-–ø—Ä–æ–¥–∞–∂–∏, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,
–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —É—á—ë—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∑–∞–∫–∞–∑–æ–≤, –æ–±—Ä–∞–±–æ—Ç–∫—É –∏ –¥–æ—Å—Ç–∞–≤–∫—É –∑–∞–∫–∞–∑–æ–≤, –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏–µ  –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã –∏ –æ–∫–∞–∑—ã–≤–∞–µ–º—ã—Ö —É—Å–ª—É–≥, –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö
–∏ –∞–∫—Ü–∏—è—Ö.
¬∑       –∑–∞—â–∏—Ç—ã –∂–∏–∑–Ω–∏, –∑–¥–æ—Ä–æ–≤—å—è –∏ –∏–Ω—ã—Ö –∂–∏–∑–Ω–µ–Ω–Ω–æ
–≤–∞–∂–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ —Å—É–±—ä–µ–∫—Ç–æ–≤ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö;
¬∑       –≤ –∏–Ω—ã—Ö –∑–∞–∫–æ–Ω–Ω—ã—Ö —Ü–µ–ª—è—Ö.

2.
–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤:
¬∑
–∑–∞–∫–æ–Ω–Ω–æ—Å—Ç–∏ —Ü–µ–ª–µ–π –∏ —Å–ø–æ—Å–æ–±–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏–π –û–ø–µ—Ä–∞—Ç–æ—Ä–∞ –∏
–Ω–µ–¥–æ–ø—É—â–µ–Ω–∏—è –û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è;
¬∑       –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
–¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö, –∑–∞—Ä–∞–Ω–µ–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∏ –∑–∞–∫–æ–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π;
¬∑       –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∏—Ö
–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–ª—è —Ü–µ–ª–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏, –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —Ü–µ–ª—è–º, –∑–∞—è–≤–ª–µ–Ω–Ω—ã–º –ø—Ä–∏ —Å–±–æ—Ä–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö
–¥–∞–Ω–Ω—ã—Ö;
¬∑       –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö,
—Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ—Ç–æ—Ä—ã—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –≤ —Ü–µ–ª—è—Ö, –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö –º–µ–∂–¥—É —Å–æ–±–æ–π;
¬∑
—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –∏ –æ–±—ä–µ–º–∞–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Ü–µ–ª—è–º –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏;
¬∑
–æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö,–∏—Ö –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏, –∞ –≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Å–ª—É—á–∞—è—Ö –∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —Ü–µ–ª—è–º
–æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö;
¬∑       —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–µ,
–ø–æ–∑–≤–æ–ª—è—é—â–µ–π –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—É–±—ä–µ–∫—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –Ω–µ –¥–æ–ª—å—à–µ, —á–µ–º —ç—Ç–æ–≥–æ—Ç—Ä–µ–±—É—é—Ç —Ü–µ–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö
–¥–∞–Ω–Ω—ã—Ö –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–º –∑–∞–∫–æ–Ω–æ–º, –¥–æ–≥–æ–≤–æ—Ä–æ–º, —Å—Ç–æ—Ä–æ–Ω–æ–π –∫–æ—Ç–æ—Ä–æ–≥–æ,–≤—ã–≥–æ–¥–æ–ø—Ä–∏–æ–±—Ä–µ—Ç–∞—Ç–µ–ª–µ–º –∏–ª–∏ –ø–æ—Ä—É—á–∏—Ç–µ–ª–µ–º –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É —è–≤–ª—è–µ—Ç—Å—è —Å—É–±—ä–µ–∫—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö
–¥–∞–Ω–Ω—ã—Ö.




3.–û–ø–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
¬∑
–∏–º—è, —Ñ–∞–º–∏–ª–∏—è, –æ—Ç—á–µ—Å—Ç–≤–æ, –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤,–∞–¥—Ä–µ—Å–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã, –∞–¥—Ä–µ—Å–∞ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏–ª–∏ –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥,
—Ä–µ–∫–≤–∏–∑–∏—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä—É—é –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –¥–æ–ª–∂–Ω–æ—Å—Ç—å –≤ –∫–æ–º–ø–∞–Ω–∏–∏,–∫–æ—Ç–æ—Ä—É—é –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∞–∫–∫–∞—É–Ω—Ç—ã
—Ç—ã –≤
–Ω—Ç—ã –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö, –∞ —Ç–∞–∫–∂–µ ‚Äî
–ø—Ä–æ—á–∏–µ, –∑–∞–ø–æ–ª–Ω—è–µ–º—ã–µ –ø–æ–ª—è
—Ñ–æ—Ä–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∏–ø–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –±—Ä–∞—É–∑–µ—Ä–∞,
      –¥–µ—Ç–∞–ª–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º—Å—Ç—Ä–∞–Ω–∏—Ü,
      IP-–∞–¥—Ä–µ—Å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≥–∏–ø–µ—Ä—Å—Å—ã–ª–∫–∏, –ø–æ
–∫–æ—Ç–æ—Ä—ã–º –ø–µ—Ä–µ—Ö–æ–¥–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–Ω—É—Ç—Ä–∏ —Å–∞–π—Ç–∞;

–ü–æ–ª—å–∑—É—è—Å—å—Å–µ—Ä–≤–∏—Å–∞–º–∏ ¬´–ó–ê–ö–ê–ó–ê–¢–¨ –ó–í–û–ù–û–ö¬ª ¬´–ü–û–î–ü–ò–°–ê–¢–¨–°–Ø –ù–ê –ö–ê–ù–ê–õ –í –¢–ï–õ–ï–ì–†–ê–ú–ú¬ª ¬´–ù–ê–ü–ò–°–ê–¢–¨ –í
–ú–ï–°–°–ï–ù–î–ñ–ï–†¬ª ¬´–û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê¬ª –∏ –ø–æ–¥–æ–±–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –Ω–∞ —Å–∞–π—Ç–µ –û–ø–µ—Ä–∞—Ç–æ—Ä–∞,–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–µ–º —Å–∞–º—ã–º –¥–∞–µ—Ç —Å–≤–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö,
—É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ –ü–æ–ª–∏—Ç–∏–∫–µ, –ø—É—Ç–µ–º –ø—Ä–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≥–∞–ª–æ—á–µ–∫ –≤ –≤–∏–¥–∂–µ—Ç–µ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ (–±–ª–æ–∫¬´–°–æ–≥–ª–∞—Å–∏–µ –∫–ª–∏–µ–Ω—Ç–∞¬ª).
–¢–∞–∫–∂–µ
–Ω–∞ –°–∞–π—Ç–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ—Ä –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è—Ö (–≤ —Ç.—á.—Ñ–∞–π–ª–æ–≤ ¬´cookie¬ª) –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º —Ñ–æ—Ä–º —Å–±–æ—Ä–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö ¬´–ó–ê–ö–ê–ó–ê–¢–¨ –ó–í–û–ù–û–ö¬ª
¬´–ü–û–î–ü–ò–°–ê–¢–¨–°–Ø –ù–ê –ö–ê–ù–ê–õ –í –¢–ï–õ–ï–ì–†–ê–ú–ú¬ª ¬´–ù–ê–ü–ò–°–ê–¢–¨ –í –ú–ï–°–°–ï–ù–î–ñ–ï–†¬ª ¬´–û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê¬ª–∏ –ø–æ–¥–æ–±–Ω—ã—Ö, –∞ —Ç–∞–∫–∂–µ –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º —Å–µ—Ä–≤–∏—Å–æ–≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∞ –∏
–¥—Ä—É–≥–∏—Ö).


4.–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∫–∞—Å–∞—é—â–∏—Ö—Å—è —Ä–∞—Å–æ–≤–æ–π,
–Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏, –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤–∑–≥–ª—è–¥–æ–≤, —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã—Ö –∏–ª–∏ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏—Ö—É–±–µ–∂–¥–µ–Ω–∏–π, –∏–Ω—Ç–∏–º–Ω–æ–π –∂–∏–∑–Ω–∏, –û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –Ω–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è.
–û–±—Ä–∞–±–æ—Ç–∫–∞
–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è, –∏–∑ —á–∏—Å–ª–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö–∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ —á. 1 —Å—Ç. 10 –ó–∞–∫–æ–Ω–∞ –æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö
–¥–∞–Ω–Ω—ã—Ö, –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è, –µ—Å–ª–∏ —Å–æ–±–ª—é–¥–∞—é—Ç—Å—è –∑–∞–ø—Ä–µ—Ç—ã –∏ —É—Å–ª–æ–≤–∏—è, –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ —Å—Ç.10.1 –ó–∞–∫–æ–Ω–∞ –æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å–≤–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–∏ —Å–≤–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö(–∞–¥—Ä–µ—Å, –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω) —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±–æ–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π –û–ø–µ—Ä–∞—Ç–æ—Ä–∞
–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –ø–µ—Ä–µ–¥ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è–æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏.
–ü–µ—Ä–µ–¥–∞—á–∞
(—Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –¥–æ—Å—Ç—É–ø) –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö—Å—É–±—ä–µ–∫—Ç–æ–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è, –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∞ –≤
–ª—é–±–æ–µ –≤—Ä–µ–º—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é —Å—É–±—ä–µ–∫—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –î–∞–Ω–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ–¥–æ–ª–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å –≤ —Å–µ–±—è —Ñ–∞–º–∏–ª–∏—é, –∏–º—è, –æ—Ç—á–µ—Å—Ç–≤–æ (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏), –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é
–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã –∏–ª–∏ –ø–æ—á—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å)—Å—É–±—ä–µ–∫—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∞ —Ç–∞–∫–∂–µ –ø–µ—Ä–µ—á–µ–Ω—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –æ–±—Ä–∞–±–æ—Ç–∫–∞
–∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–¥–ª–µ–∂–∏—Ç –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏—é. –£–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ –¥–∞–Ω–Ω–æ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ–º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º, –∫–æ—Ç–æ—Ä–æ–º—É –æ–Ω–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ.
–°–æ–≥–ª–∞—Å–∏–µ
–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è, –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç—Å–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –û–ø–µ—Ä–∞—Ç–æ—Ä—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
5.–û–ø–µ—Ä–∞—Ç–æ—Ä –∏ –µ–≥–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∏ –Ω–µ—Å—É—Ç –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–æ-–ø—Ä–∞–≤–æ–≤—É—é, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É—é –∏ –∏–Ω—É—é
–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –Ω–µ—Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –∏ —É—Å–ª–æ–≤–∏–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö–¥–∞–Ω–Ω—ã—Ö, –∞ —Ç–∞–∫–∂–µ –∑–∞ —Ä–∞–∑–≥–ª–∞—à–µ–Ω–∏–µ –∏–ª–∏ –Ω–µ–∑–∞–∫–æ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏. –ü–æ—Ä—è–¥–æ–∫ –¥–æ—Å—Ç—É–ø–∞—Å—É–±—ä–µ–∫—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫ –µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–º
–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –†–æ—Å—Å–∏–π—Å–∫–æ–π–§–µ–¥–µ—Ä–∞—Ü–∏–∏ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –û–ø–µ—Ä–∞—Ç–æ—Ä–∞.
6.
–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏,–∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å—Ä–æ–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏, –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–≥–æ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–º–∏ –∑–∞–∫–æ–Ω–∞–º–∏, –¥–æ–≥–æ–≤–æ—Ä–æ–º
–∏–ª–∏ —Å–æ–≥–ª–∞—Å–∏–µ–º —Å—É–±—ä–µ–∫—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö–¥–∞–Ω–Ω—ã—Ö. –ü—Ä–∏ –æ—Ç–∑—ã–≤–µ —Å—É–±—ä–µ–∫—Ç–æ–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –µ–≥–æ
–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è–∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–Ω–µ–µ –∑–∞–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Å –Ω–∏–º –¥–æ–≥–æ–≤–æ—Ä–æ–≤, –∞ —Ç–∞–∫–∂–µ –≤ —Å–ª—É—á–∞—è—Ö,
–ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏.




7.–°—É–±—ä–µ–∫—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–º–µ—é—Ç –ø—Ä–∞–≤–æ –Ω–∞:
-–ø–æ–ª—É—á–µ–Ω–∏–µ
–ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö –û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º;
-—É—Ç–æ—á–Ω–µ–Ω–∏–µ—Å–≤–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏
–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —è–≤–ª—è—é—Ç—Å—è –Ω–µ–ø–æ–ª–Ω—ã–º–∏, —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏, –Ω–µ—Ç–æ—á–Ω—ã–º–∏, –Ω–µ–∑–∞–∫–æ–Ω–Ω–æ–ø–æ–ª—É—á–µ–Ω–Ω—ã–º–∏ –∏–ª–∏ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –¥–ª—è –∑–∞—è–≤–ª–µ–Ω–Ω–æ–π —Ü–µ–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏;
-–æ—Ç–∑—ã–≤
—Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö;
-–ø—Ä–∏–Ω—è—Ç–∏–µ–ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏ –º–µ—Ä –ø–æ –∑–∞—â–∏—Ç–µ —Å–≤–æ–∏—Ö
–ø—Ä–∞–≤;
8.–ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –û–ø–µ—Ä–∞—Ç–æ—Ä —Å —É—á—ë—Ç–æ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞
–†–æ—Å—Å–∏–π—Å–∫–æ–π
–§–µ–¥–µ—Ä–∞—Ü–∏–∏ –≤ –æ–±–ª–∞—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–æ–¥–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏ –ø—Ä–∞–≤–æ–≤—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –¥–ª—è –∑–∞—â–∏—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö
–¥–∞–Ω–Ω—ã—Ö –æ—Ç –Ω–µ–ø—Ä–∞–≤–æ–º–µ—Ä–Ω–æ–≥–æ –∏–ª–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∏–º, —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è, –∏–∑–º–µ–Ω–µ–Ω–∏—è,–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö,
–∞ —Ç–∞–∫–∂–µ –æ—Ç –∏–Ω—ã—Ö –Ω–µ–ø—Ä–∞–≤–æ–º–µ—Ä–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö,–ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –û–ø–µ—Ä–∞—Ç–æ—Ä–∞.
9.
–û–ø–µ—Ä–∞—Ç–æ—Ä –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–∞—Ö –∏—É—Å–ª—É–≥–∞—Ö, —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö –∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞
–º–æ–∂–µ—Ç –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –Ω–∞–ø—Ä–∞–≤–∏–≤ –û–ø–µ—Ä–∞—Ç–æ—Ä—É–ø–∏—Å—å–º–æ –Ω–∞ –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã info@florimondi.ru —Å
–ø–æ–º–µ—Ç–∫–æ–π ¬´–û—Ç–∫–∞–∑ –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–∞—Ö –∏ —É—Å–ª—É–≥–∞—Ö –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö¬ª, –∞ —Ç–∞–∫–∂–µ –ø–æ–∑–≤–æ–Ω–∏–≤ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É +7977-299-36-29 –∏–ª–∏ –Ω–∞–ø–∏—Å–∞–≤ –≤
–º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
10.–ü–æ–ª–∏—Ç–∏–∫–∞ –Ω–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∏ –Ω–∞ –∫–∞–∫–∏–µ –¥—Ä—É–≥–∏–µ —Å–∞–π—Ç—ã –∏ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–∞ –∫
–≤–µ–±-—Å–∞–π—Ç–∞–º —Ç—Ä–µ—Ç—å–∏—Ö –ª–∏—Ü, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –Ω–∞—à–µ–º —Å–∞–π—Ç–µ –∏ —Å–∫–æ—Ç–æ—Ä—ã—Ö –º–æ–≥—É—Ç –¥–µ–ª–∞—Ç—å—Å—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–∞–π—Ç, –∞ —Ç–∞–∫–∂–µ —Å—Å—ã–ª–∫–∏ —Å —ç—Ç–æ–≥–æ —Å–∞–π—Ç–∞ –Ω–∞ –¥—Ä—É–≥–∏–µ
—Å–∞–π—Ç—ã —Å–µ—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç. –ú—ã –Ω–µ –Ω–µ—Å–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –¥–µ–π—Å—Ç–≤–∏—è –¥—Ä—É–≥–∏—Ö –≤–µ–±-—Å–∞–π—Ç–æ–≤.
11.–û–ø–µ—Ä–∞—Ç–æ—Ä –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é –æ–±–Ω–æ–≤–ª—è—Ç—å –¥–∞–Ω–Ω—É—é –ø–æ–ª–∏—Ç–∏–∫—É
–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è. –ú—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Ä–µ–≥—É–ª—è—Ä–Ω–æ–ø—Ä–æ–≤–µ—Ä—è—Ç—å —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É https://florimondi.ru/privacy-policy/
–¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –±—ã—Ç—å –≤ –∫—É—Ä—Å–µ –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ —Ç–æ–º, –∫–∞–∫ –º—ã –∑–∞—â–∏—â–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö, –∫–æ—Ç–æ—Ä—É—é –º—ã —Å–æ–±–∏—Ä–∞–µ–º. –ò—Å–ø–æ–ª—å–∑—É—è —Å–∞–π—Ç, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å
–ø—Ä–∏–Ω—è—Ç–∏–µ–º –Ω–∞ —Å–µ–±—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ –Ω–µ–π.
12.
–ù–∞—Å—Ç–æ—è—â–∏–º, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ:
¬∑       –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω –∏ —Å–æ–≥–ª–∞—Å–µ–Ω —Å —Ç–µ–º, —á—Ç–æ –ø–µ—Ä–µ–¥–∞—á–∞
–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è –û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –≤ –æ–±—ä–µ–º–µ,–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–æ—Å—Ç—É–ø–∞ –∫ –°–∞–π—Ç—É, –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é –∏/–∏–ª–∏
–µ–≥–æ —Å–µ—Ä–≤–∏—Å—É/—Å–µ—Ä–≤–∏—Å–∞–º –ø—É—Ç–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π –∏/–∏–ª–∏ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö–∫ —Ñ–æ—Ä–º–∞–º —Ñ–∞–π–ª–æ–≤;
¬∑
–≤—ã—Ä–∞–∂–∞–µ—Ç –ø–æ–ª–Ω–æ–µ, –±–µ–∑–æ–≥–æ–≤–æ—Ä–æ—á–Ω–æ–µ –∏–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–≤–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –¥–ª—è
—Ü–µ–ª–µ–π –û–ø–µ—Ä–∞—Ç–æ—Ä–∞
¬∑       –ø—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∑—ã–≤–∞
—Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –ø–æ–ª–æ–∂–µ–Ω–∏–π –§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–∞ –æ—Ç 27.07.2006 ‚Ññ 152-–§–ó ¬´–û–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö¬ª –ø—É—Ç–µ–º –ª–∏—á–Ω–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –∏–ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∏—Å—å–º–µ–Ω–Ω–æ–≥–æ
–æ–±—Ä–∞—â–µ–Ω–∏—è (–≤ —Ç–æ–º —á–∏—Å–ª–µ –≤ —Ñ–æ—Ä–º–µ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç–æ–π—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é –∏–ª–∏ —É—Å–∏–ª–µ–Ω–Ω–æ–π –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é), –Ω–∞
–∏–º—è –û–ø–µ—Ä–∞—Ç–æ—Ä–∞, –≤ —Ç–æ–º —á–∏—Å–ª–µ –ø—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –æ –ø—Ä–∞–≤–µ –æ—Ç–æ–∑–≤–∞—Ç—å –°–æ–≥–ª–∞—Å–∏–µ –≤ —Ü–µ–ª—è—Ö–ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º;
¬∑
–ø—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω, —á—Ç–æ –û–ø–µ—Ä–∞—Ç–æ—Ä –≤–ø—Ä–∞–≤–µ–ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞
–°–æ–≥–ª–∞—Å–∏—è, –∞ —Ä–∞–≤–Ω–æ –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –°–æ–≥–ª–∞—Å–∏—è, –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏–æ—Å–Ω–æ–≤–∞–Ω–∏–π, –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö —á–∞—Å—Ç—å—é 2 —Å—Ç–∞—Ç—å–∏ 9 –§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–∞ –æ—Ç 27.07.2006
‚Ññ 152-–§–ó ¬´–û –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö¬ª;























–°–û–ì–õ–ê–°–ò–ï –ù–ê
–û–ë–†–ê–ë–û–¢–ö–£ –ü–ï–†–°–û–ù–ê–õ–¨–ù–´–• –î–ê–ù–ù–´–•

–î–µ–π—Å—Ç–≤—É—è —Å–≤–æ–±–æ–¥–Ω–æ,—Å–≤–æ–µ–π –≤–æ–ª–µ–π –∏ –≤ —Å–≤–æ–µ–º –∏–Ω—Ç–µ—Ä–µ—Å–µ, –∞ —Ç–∞–∫–∂–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—è —Å–≤–æ—é –¥–µ–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å, –¥–∞—é
—Å–≤–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–º—É –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—é –ö–∞—Ä–ø—É–Ω–∏–Ω—É –ê–Ω–¥—Ä–µ—é –ê–Ω–∞—Ç–æ–ª—å–µ–≤–∏—á—É  –ò–ù–ù: 771971874638 –û–ì–†–ù–ò–ü: 320774600392892  (–¥–∞–ª–µ–µ ‚Äì –û–ø–µ—Ä–∞—Ç–æ—Ä), –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–≤–æ–∏—Ö–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏:

1.–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:

1.1. –î–∞–Ω–Ω–æ–µ–°–æ–≥–ª–∞—Å–∏–µ –¥–∞–µ—Ç—Å—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∫–∞–∫ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤
–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏, —Ç–∞–∫ –∏ —Å –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º. –°–æ–≥–ª–∞—Å–∏–µ –¥–∞–µ—Ç—Å—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É—Å–ª–µ–¥—É—é—â–∏—Ö –º–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: –∏–º—è, —Ñ–∞–º–∏–ª–∏—è, –æ—Ç—á–µ—Å—Ç–≤–æ, –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤,
–∞–¥—Ä–µ—Å–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã, –∞–¥—Ä–µ—Å–∞ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏–ª–∏ –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥,—Ä–µ–∫–≤–∏–∑–∏—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä—É—é –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –¥–æ–ª–∂–Ω–æ—Å—Ç—å –≤ –∫–æ–º–ø–∞–Ω–∏–∏,
–∫–æ—Ç–æ—Ä—É—é –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∞–∫–∫–∞—É–Ω—Ç—ã –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö –ª–∏–±–æ –¥—Ä—É–≥—É—é–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–æ—Ç–æ—Ä—É—é –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—á–∏—Ç–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º —Å–æ–æ–±—â–∏—Ç—å; –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏
—Ñ–æ—Ä–º: ¬´–ó–ê–ö–ê–ó–ê–¢–¨ –ó–í–û–ù–û–ö¬ª ¬´–ü–û–î–ü–ò–°–ê–¢–¨–°–Ø –ù–ê –ö–ê–ù–ê–õ –í –¢–ï–õ–ï–ì–†–ê–ú–ú¬ª ¬´–ù–ê–ü–ò–°–ê–¢–¨ –í–ú–ï–°–°–ï–ù–î–ñ–ï–†¬ª ¬´–û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê –∏ –∏–Ω—ã–º —Å—Ä–µ–¥—Å—Ç–≤–∞–º –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏, —Ä–∞–∑–º–µ—â–µ–Ω–Ω—ã—Ö –ø–æ
–∞–¥—Ä–µ—Å—É florimondi.ru –∏ —á–∞—Ç–±–æ—Ç—É —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–º—É –Ω–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Ä–µ—Å—É—Ä—Å–µ Telegram Messenger
nger –ø–æ –∞–¥—Ä–µ—Å—É @Flori_Mondi_Bot
(–¥–∞–ª–µ–µ ‚Äì –°–∞–π—Ç –∏ —á–∞—Ç –±–æ—Ç) –°–æ—Å—Ç–∞–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

1.2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
–¥–∞–µ—Ç —Å–≤–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –û–ø–µ—Ä–∞—Ç–æ—Ä—É –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—É—é–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –û–ø–µ—Ä–∞—Ç–æ—Ä–∞

1.3. –¶–µ–ª—å—é
–æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —è–≤–ª—è–µ—Ç—Å—è:
¬∑       –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫
—Å–µ—Ä–≤–∏—Å–∞–º, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏/–∏–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º—Å—è –Ω–∞ –°–∞–π—Ç–µ.
¬∑       –ø—Ä–æ–¥–∞–∂–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥, –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
–¥–æ–≥–æ–≤–æ—Ä–æ–≤ –∫—É–ø–ª–∏-–ø—Ä–æ–¥–∞–∂–∏, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —É—á—ë—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∑–∞–∫–∞–∑–æ–≤, –æ–±—Ä–∞–±–æ—Ç–∫—É –∏ –¥–æ—Å—Ç–∞–≤–∫—É –∑–∞–∫–∞–∑–æ–≤, –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏–µ
–∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã –∏ –æ–∫–∞–∑—ã–≤–∞–µ–º—ã—Ö —É—Å–ª—É–≥, –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö–∏ –∞–∫—Ü–∏—è—Ö
¬∑
–∑–∞—â–∏—Ç—ã –∂–∏–∑–Ω–∏, –∑–¥–æ—Ä–æ–≤—å—è –∏ –∏–Ω—ã—Ö –∂–∏–∑–Ω–µ–Ω–Ω–æ–≤–∞–∂–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ —Å—É–±—ä–µ–∫—Ç–æ–≤ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö;
¬∑
–≤ –∏–Ω—ã—Ö –∑–∞–∫–æ–Ω–Ω—ã—Ö —Ü–µ–ª—è—Ö.

1.4. –í —Ö–æ–¥–µ–æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –±—É–¥—É—Ç —Å–æ–≤–µ—Ä—à–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è: —Å–±–æ—Ä;
–∑–∞–ø–∏—Å—å; —Å–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏—è; –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ; —Ö—Ä–∞–Ω–µ–Ω–∏–µ; —É—Ç–æ—á–Ω–µ–Ω–∏–µ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ,–∏–∑–º–µ–Ω–µ–Ω–∏–µ); –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ; –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ; –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ; —É–¥–∞–ª–µ–Ω–∏–µ; —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ.

1.5.
–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è —Å–≤–æ–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–≥–ª–∞—à–∞–µ—Ç—Å—è –Ω–∞ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫—É–û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º, –≤ —Ü–µ–ª—è—Ö –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º —Å–≤–æ–∏—Ö –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –ø–µ—Ä–µ–¥
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å–≤–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–∏ —Å–≤–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∞–¥—Ä–µ—Å, –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω) —Ç—Ä–µ—Ç—å–∏–º
–ª–∏—Ü–∞–º –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±–æ–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π –û–ø–µ—Ä–∞—Ç–æ—Ä–∞ –∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
–û–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –ø–µ—Ä–µ–¥ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º: –Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è–¥–æ—Å—Ç–∞–≤–∫–∏.

1.6. –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ
–¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–∏–±–æ –¥–æ –æ—Ç–∑—ã–≤–∞ —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞–æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫–æ–µ –∏–∑ —Å–æ–±—ã—Ç–∏–π –Ω–∞—Å—Ç—É–ø–∏—Ç
—Ä–∞–Ω—å—à–µ.

1.7. –ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –û–ø–µ—Ä–∞—Ç–æ—Ä —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É–µ—Ç—Å—è –§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–º –∑–∞–∫–æ–Ω–æ–º
¬´–û –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö¬ª –∏ –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

1.8. –í —Å–ª—É—á–∞–µ–≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –ª—é–±–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–µ
–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–º –∑–∞–∫–æ–Ω–æ–º –æ—Ç 27.07.2006 ‚Ññ 152-–§–ó ¬´–û –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö¬ª –≤ —á–∞—Å—Ç–∏–æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
–û–ø–µ—Ä–∞—Ç–æ—Ä—É –≤ –ø–æ—Ä—è–¥–∫–µ, –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–º –ü–æ–ª–∏—Ç–∏–∫–æ–π –û–ø–µ—Ä–∞—Ç–æ—Ä–∞ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∞–π—Ç–∞, —Ä–∞–∑–º–µ—â–µ–Ω–Ω–æ–π –ø–æ –∞–¥—Ä–µ—Å—É https://www..ru/politika-obrabotki-personalnyh-dannyh.

1.9. –í —Å–ª—É—á–∞–µ
–≤—ã—è–≤–ª–µ–Ω–∏—è –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–µ–π –≤ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å–∏—Ö —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –Ω–∞–ø—Ä–∞–≤–∏–≤ –û–ø–µ—Ä–∞—Ç–æ—Ä—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã
–û–ø–µ—Ä–∞—Ç–æ—Ä–∞ info@florimondi.ru —Å–ø–æ–º–µ—Ç–∫–æ–π ¬´–ê–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö¬ª.

1.10. –°—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏
–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ–º —Ü–µ–ª–µ–π, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –±—ã–ª–∏ —Å–æ–±—Ä–∞–Ω—ã–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –∏–Ω–æ–π —Å—Ä–æ–∫ –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω –¥–æ–≥–æ–≤–æ—Ä–æ–º –∏–ª–∏ –¥–µ–π—Å—Ç–≤—É—é—â–∏–º
–∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º.

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç–≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –æ—Ç–æ–∑–≤–∞—Ç—å —Å–≤–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö,
–Ω–∞–ø—Ä–∞–≤–∏–≤ –û–ø–µ—Ä–∞—Ç–æ—Ä—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã –Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π–∞–¥—Ä–µ—Å –û–ø–µ—Ä–∞—Ç–æ—Ä–∞ info@florimondi.ru —Å
–ø–æ–º–µ—Ç–∫–æ–π ¬´–û—Ç–∑—ã–≤ —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö¬ª.

1.11. –û–ø–µ—Ä–∞—Ç–æ—Ä–≤–ø—Ä–∞–≤–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é ¬´cookies¬ª. Cookies ‚Äì —ç—Ç–æ –Ω–µ–±–æ–ª—å—à–æ–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç
–¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π —Å–∞–π—Ç –û–ø–µ—Ä–∞—Ç–æ—Ä–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –±—Ä–∞—É–∑–µ—Ä–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –Ω–∞–∫–æ–º–ø—å—é—Ç–µ—Ä–µ –∏–ª–∏ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. Cookies –æ—Ç—Ä–∞–∂–∞—é—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
–ü–æ—Å–µ—Ç–∏—Ç–µ–ª—è –∏–ª–∏ –µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –°–∞–π—Ç–µ, –∞ —Ç–∞–∫–∂–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ–± –µ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏,–¥–∞—Ç–µ –∏ –≤—Ä–µ–º–µ–Ω–∏ —Å–µ—Å—Å–∏–∏. –°ookies —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –∏–ª–∏ –º–æ–±–∏–ª—å–Ω–æ–º
—É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –°ookies –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞.
Cookies –Ω–µ
—Å–æ–¥–µ—Ä–∂–∞—Ç –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º–ø–æ—Å–µ—â–µ–Ω–∏–∏ —Å–∞–π—Ç–∞ –û–ø–µ—Ä–∞—Ç–æ—Ä–∞ —Å –ø–æ–º–æ—â—å—é –Ω–æ–≤–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞ –∏–ª–∏ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
—Å–∞–π—Ç–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –±–∞–Ω–Ω–µ—Ä, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–∏–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–± –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏–∏—Å–±–æ—Ä–∞ –°ookies –∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–∏–π —Å–æ–≥–ª–∞—Å–∏–µ –ü–æ—Å–µ—Ç–∏—Ç–µ–ª—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –µ–≥–æ –°ookies.
–ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É ¬´–°–æ–≥–ª–∞—Å–µ–Ω¬ª
–∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–∞–π—Ç–æ–º –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–≤–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞–æ–±—Ä–∞–±–æ—Ç–∫—É –µ–≥–æ –°ookies, –∞ —Ç–∞–∫–∂–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–æ–∂–µ–Ω–∏—è–º–∏ –ü–æ–ª–∏—Ç–∏–∫–∏.
–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ
–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –°—Å–π—Ç–æ–º –æ–∑–Ω–∞—á–∞–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø–µ—Ä–µ—Ö–æ–¥–∞–ø–æ –ª—é–±–æ–π —Å—Å—ã–ª–∫–µ, —Ä–∞–∑–º–µ—â–µ–Ω–Ω–æ–π –Ω–∞ —Å–∞–π—Ç–µ, –∏–ª–∏ –Ω–∞–∂–∞—Ç–∏–µ –ª—é–±–æ–π –∫–Ω–æ–ø–∫–∏ –Ω–∞ –°–∞–π—Ç–µ, –∞
—Ç–∞–∫–∂–µ –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–∞ –ª—é–±–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –°–∞–π—Ç–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç–æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –°ookies –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–≤–æ–µ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞ (–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è
—Å –¥–∞–Ω–Ω–æ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –º–æ–∂–Ω–æ –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–°–ø—Ä–∞–≤–∫–∞¬ª —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞). –í—Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ —Å–∞–π—Ç –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ Cookies, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç—Ä–æ–≥–æ
–Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã—Ö –∏–º —Å–µ—Ä–≤–∏—Å–æ–≤, –æ–¥–Ω–∞–∫–æ —Ç–∞–∫–æ–π–æ—Ç–∫–∞–∑ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–µ —Å–∞–π—Ç–∞

1.12. –≠—Ç–æ—Ç —Å–∞–π—Ç
–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ä–≤–∏—Å –≤–µ–±-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–π –∫–æ–º–ø–∞–Ω–∏–µ–π –û–û–û¬´–Ø–ù–î–ï–ö–°¬ª, 119021, –†–æ—Å—Å–∏—è, –ú–æ—Å–∫–≤–∞, —É–ª. –õ. –¢–æ–ª—Å—Ç–æ–≥–æ, 16 (–¥–∞–ª–µ–µ ‚Äî –Ø–Ω–¥–µ–∫—Å)
–°–µ—Ä–≤–∏—Å –Ø–Ω–¥–µ–∫—Å
–ú–µ—Ç—Ä–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é ¬´cookie¬ª.
–°–æ–±—Ä–∞–Ω–Ω–∞—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ cookie –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –º–æ–∂–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤–∞—Å, –æ–¥–Ω–∞–∫–æ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å –Ω–∞–º
—É–ª—É—á—à–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞—à–µ–≥–æ —Å–∞–π—Ç–∞. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≤–∞–º–∏ –¥–∞–Ω–Ω–æ–≥–æ —Å–∞–π—Ç–∞,–±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –∏ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ø–Ω–¥–µ–∫—Å–∞ –≤ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏.
–Ø–Ω–¥–µ–∫—Å –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Å —Ü–µ–ª—å—é –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
–í—ã –º–æ–∂–µ—Ç–µ
–æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è cookies, –≤—ã–±—Ä–∞–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
–ò—Å–ø–æ–ª—å–∑—É—è —ç—Ç–æ—Ç
—Å–∞–π—Ç, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –æ –≤–∞—Å –Ø–Ω–¥–µ–∫—Å–æ–º –≤ –ø–æ—Ä—è–¥–∫–µ –∏ —Ü–µ–ª—è—Ö,—É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ –ü–æ–ª–∏—Ç–∏–∫–µ –û–ø–µ—Ä–∞—Ç–æ—Ä–∞
–ü–µ—Ä–µ—á–µ–Ω—å –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–±–∏—Ä–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –ø–æ —Å—Å—ã–ª–∫–µ:
https://yandex.ru/support/metrica/code/data-collected.html

1.13. –û–ø–µ—Ä–∞—Ç–æ—Ä –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —Å–≤–µ–¥–µ–Ω–∏—è, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –Ω–∞ —Å–∞–π—Ç–µ –≤
–æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω–æ–π —Ñ–æ—Ä–º–µ.

1.14. –û–ø–µ—Ä–∞—Ç–æ—Ä –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–µ
–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã –¥–ª—è –∑–∞—â–∏—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç –Ω–µ–ø—Ä–∞–≤–æ–º–µ—Ä–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∏–º.`
import TelegramBot from 'node-telegram-bot-api';
import { generateCalendar, getMonthName } from './calendar.js';
import { MongoClient } from 'mongodb';
import Robokaska from 'robokassa';
import { Calendar } from 'telegram-inline-calendar';
import { getAvailableShippingTime } from './avaliableShippingTime.js';
import cors from 'cors';
import { Readable } from 'stream';

import dotenv from 'dotenv';
dotenv.config();
import express from 'express';

import crypto from 'crypto';
import { startAddProcess, cancelProcess, startEditProcess } from './processes/processes.js';
import validateAddress, { getAddressFromCoordinates } from './validateAddress.js';
import axios from 'axios';
import { log } from 'console';

// –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
const BOT_TOKEN = process.env.BOT_TOKEN;

const app = express();
console.log('üü¢ –§–∞–π–ª bot.js –Ω–∞—á–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ'); // –ü—Ä–æ–≤–µ—Ä–∏–º, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ª–∏ —Å–∫—Ä–∏–ø—Ç –≤–æ–æ–±—â–µ
app.use(cors());
const bot = new TelegramBot(BOT_TOKEN, { polling: true });
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.get('/result', (req, res) => {
  console.log('Hello World!');

  return res.status(200).json({ message: 'Transaction completed successfully' });
});
app.get('/fail', (req, res) => {
  return res.status(200).json({ message: 'Transaction failed' });
});

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã (SignatureValue)
function calculateSignature(OutSum, InvId, password2, additionalParams = '') {
  const baseString = `${OutSum}:${InvId}:${password2}`;
  const hash = md5(baseString);
  return hash;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç Robokassa –Ω–∞ ResultURL

let db;
let collectionUser;
let collectionProduct;
let collectionCategory;

console.log('üü° –ü—ã—Ç–∞—é—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MongoDB...');
MongoClient.connect(
  'mongodb+srv://quard:Screaper228@cluster0.zyg0fil.mongodb.net/?retryWrites=true&w=majority',
  {
    useNewUrlParser: true,
    useUnifiedTopology: true,
  }
)
  .then((client) => {
    db = client.db();
    collectionUser = db.collection('dbUser');
    collectionProduct = db.collection('dbz');
    collectionCategory = db.collection('flower-category');
    console.log('Connected to MongoDB');
  })
  .catch((err) => {
    console.error('Error connecting to MongoDB', err);
  });

async function processPaymentNotification(req, res) {
  // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ Robokassa
  try {
    if (!req.body) {
      return res.status(400).json({ message: 'Bad request' });
    }
    const {
      OutSum,
      InvId,
      Fee,
      EMail,
      SignatureValue,
      PaymentMethod,
      IncCurrLabel,
      IsTest,
      ...additionalParams
    } = req.body;
    console.log(req.body);

    // –ü–∞—Ä–æ–ª—å 2, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ö—ç—à–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å)
    const password2 = 'VPXkrnNyoI9865vDif2k';
    if (!collectionUser) {
      return;
    }

    const invIdNumber = Number(InvId);
    const user = await collectionUser.findOne({ invId: invIdNumber });

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã
    let additionalParamsString = '';
    if (Object.keys(additionalParams).length > 0) {
      additionalParamsString = Object.entries(additionalParams)
        .map(([key, value]) => `${key}=${value}`)
        .join(':');
    }

    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ö—ç—à
    const calculatedHash = await calculateSignature(
      OutSum,
      InvId,
      password2,
      additionalParamsString
    );
    console.log(calculatedHash, SignatureValue);
    if (!calculatedHash) {
      return res.status(400).json({ message: 'Bad request' });
    }
    if (!SignatureValue) {
      return res.status(400).json({ message: 'Bad request' });
    }
    // –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞
    if (calculatedHash.toUpperCase() === SignatureValue.toUpperCase()) {
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
      if (IsTest === '1') {
        console.log(
          `–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º! –û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–∞. InvId: ${InvId}, –°—É–º–º–∞: ${OutSum}, Email: ${EMail}`
        );
      } else {
        console.log(`–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∞! InvId: ${InvId}, –°—É–º–º–∞: ${OutSum}, Email: ${EMail}`);
      }

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç Robokassa –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      await res.status(200).send(`OK${InvId}`);

      const response = await axios.get(
        `https://api.telegram.org/bot${BOT_TOKEN}/getFile?file_id=${user.photo}`
      );

      const filePath = await response.data.result.file_path;

      // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–æ—Ç–æ
      const photoUrl = `https://api.telegram.org/file/bot${BOT_TOKEN}/${filePath}`;
      console.log(photoUrl);
      await bot.sendMessage(
        -1002291227368,
        `‚úÖ *–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∞!*\n\n` +
          `üí∞ *–¶–µ–Ω–∞:* ${user.price}\n` +
          `üìß *Email:* ${EMail}\n` +
          `üì∑ *–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ:* [–û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ç–æ](${photoUrl})\n` +
          `üìû *–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∑–∞–∫–∞–∑—á–∏–∫–∞:* ${
            user.clientNumber ? user.clientNumber : '–ù–µ —É–∫–∞–∑–∞–Ω –Ω–æ–º–µ—Ä'
          }\n` +
          `üìû *–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:* ${
            user.recipientNumber ? user.recipientNumber : '–ù–µ —É–∫–∞–∑–∞–Ω –Ω–æ–º–µ—Ä'
          }\n` +
          `üìç *–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:* ${user.address ? user.address : '–ù–µ —É–∫–∞–∑–∞–Ω –∞–¥—Ä–µ—Å'}\n` +
          `üìÖ *–î–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:* ${user.selectedDate ? user.selectedDate : '–ù–µ —É–∫–∞–∑–∞–Ω–∞ –¥–∞—Ç–∞'}\n` +
          `‚è∞–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏:* ${
            user.address !== '–°–∞–º–æ–≤—ã–≤–æ–∑' ? '–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏' : '–£–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Å–∞–º–æ–≤—ã–≤–æ–∑–∞'
          }* ${user.time ? user.time : '–ù–µ —É–∫–∞–∑–∞–Ω–æ –≤—Ä–µ–º—è'}\n` +
          `üìù *–¢–µ–∫—Å—Ç –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∫–∏:* ${user.postcard ? user.postcard : '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}\n\n` +
          `üìù *–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:* ${
            user.extraInformation ? user.extraInformation : '–ù–µ —É–∫–∞–∑–∞–Ω–æ'
          }\n\n`,
        {
          parse_mode: 'Markdown',
        }
      );
      await bot.sendMessage(
        user.userId,
        `‚úÖ *–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∞!*\n\n` +
          `üí∞ *–¶–µ–Ω–∞:* ${user.price}\n` +
          `üìß *Email:* ${EMail}\n` +
          `üì∑ *–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ:* [–û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ç–æ](${photoUrl})\n` +
          `üìû *–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∑–∞–∫–∞–∑—á–∏–∫–∞:* ${
            user.clientNumber ? user.clientNumber : '–ù–µ —É–∫–∞–∑–∞–Ω –Ω–æ–º–µ—Ä'
          }\n` +
          `üìû *–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:* ${
            user.recipientNumber ? user.recipientNumber : '–ù–µ —É–∫–∞–∑–∞–Ω –Ω–æ–º–µ—Ä'
          }\n` +
          `üìç *–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:* ${user.address ? user.address : '–ù–µ —É–∫–∞–∑–∞–Ω –∞–¥—Ä–µ—Å'}\n` +
          `üìÖ *–î–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:* ${user.selectedDate ? user.selectedDate : '–ù–µ —É–∫–∞–∑–∞–Ω–∞ –¥–∞—Ç–∞'}\n` +
          `‚è∞ *–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏/–£–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Å–∞–º–æ–≤—ã–≤–æ–∑–∞:* ${
            user.time ? user.time : '–ù–µ —É–∫–∞–∑–∞–Ω–æ –≤—Ä–µ–º—è'
          }\n` +
          `üìù *–¢–µ–∫—Å—Ç –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∫–∏:* ${user.postcard ? user.postcard : '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}\n\n` +
          `üìù *–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:* ${
            user.extraInformation ? user.extraInformation : '–ù–µ —É–∫–∞–∑–∞–Ω–æ'
          }\n\n`,
        {
          parse_mode: 'Markdown',
          reply_markup: {
            keyboard: [['–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é']],
            resize_keyboard: true, // –î–µ–ª–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º–∏
            one_time_keyboard: true, // –£–±–∏—Ä–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è
          },
        }
      );
      await collectionUser.updateOne(
        { userId: user.userId },
        { $set: { processType: 'finished' } }
      );
    } else {
      // –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã –Ω–µ —Å–æ–≤–ø–∞–ª–∏ ‚Äî –æ—à–∏–±–∫–∞
      console.error(`–û—à–∏–±–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è InvId: ${InvId}`);

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—à–∏–±–∫—É –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
      res.status(400).send('Error');
    }
  } catch (e) {
    console.log(e);
  }
}
app.post('/payment-success', processPaymentNotification);

// –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ç–æ
async function handlePhoto(userId, photoFileId) {
  const user = await collectionUser.findOne({ userId });
  console.log(user.step);

  if (user && user.step === 'getIndex') {
    return '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä –ø—Ä–µ–¥–º–µ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å.';
  }
  if (!user || user.step !== 'getPhoto') {
    return;
  }

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ç–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
  await collectionUser.updateOne({ userId }, { $set: { photo: photoFileId } });

  // –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–≥ –ø—Ä–æ—Ü–µ—Å—Å–∞
  await collectionUser.updateOne({ userId }, { $set: { step: 'getPrice' } });

  return '–§–æ—Ç–æ –ø–æ–ª—É—á–µ–Ω–æ! –¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞.';
}

// –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ü–µ–Ω—ã
async function handlePrice(userId, priceText) {
  const price = parseFloat(priceText);
  if (isNaN(price) || price <= 0) {
    return '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞. –ù–∞–ø—Ä–∏–º–µ—Ä: 100, 199.99';
  }

  const user = await collectionUser.findOne({ userId });
  if (!user || user.step !== 'getPrice') {
    return;
  }

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
  await collectionUser.updateOne({ userId }, { $set: { price } });

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é –ø—Ä–æ–¥—É–∫—Ç–æ–≤
  const userPhoto = user.photo;
  if (user.processType === 'edit') {
    const productId = user.productId;
    await collectionProduct.updateOne(
      { _id: productId },
      {
        $set: {
          photo: userPhoto,
          price: price,
          addedAt: new Date(),
        },
      }
    );
    await collectionUser.updateOne(
      { userId },
      {
        $set: {
          isInProcess: false,
          step: null,
          processType: null,
          photo: null,
          price: null,
        },
      }
    );
    return '–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö!';
  }
  await collectionProduct.insertOne({
    photo: userPhoto,
    price: price,
    addedAt: new Date(),
  });

  // –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
  await collectionUser.updateOne(
    { userId },
    {
      $set: {
        isInProcess: false,
        step: null,
        processType: null,
        photo: null,
        price: null,
      },
    }
  );

  return '–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!';
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É
async function handleEdit(userId, index) {
  const user = await collectionUser.findOne({ userId });
  if (!user || user.processType !== 'edit') {
    return;
  }

  if (isNaN(index) || index <= 0 || index > 100) {
    return '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —Ç–æ–≤–∞—Ä–∞.';
  }
  const indexInt = parseInt(index);
  const document = await collectionProduct
    .find()
    .skip(indexInt - 1)
    .limit(1)
    .next();
  if (!document) {
    return '–ü—Ä–µ–¥–º–µ—Ç —Å —Ç–∞–∫–∏–º –∏–Ω–¥–µ–∫—Å–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.';
  }

  await collectionUser.updateOne(
    { userId },
    { $set: { step: 'getPhoto', productId: document._id } }
  );

  return '–ü—Ä–µ–¥–º–µ—Ç –Ω–∞–π–¥–µ–Ω! –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞.';
}
function md5(string) {
  return crypto.createHash('md5').update(string).digest('hex').toUpperCase();
}

// –í–∫–ª—é—á–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

function generatePaymentLink(merchantLogin, password1, invId, outSum, description, isTest = false) {
  // –§–æ—Ä–º–∏—Ä—É–µ–º JSON-–æ–±—ä–µ–∫—Ç —Å —Ñ–∏—Å–∫–∞–ª—å–Ω—ã–º —á–µ–∫–æ–º (54-–§–ó)
  const receipt = {
    items: [
      {
        name: '–ë—É–∫–µ—Ç —Ü–≤–µ—Ç–æ–≤', // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
        quantity: 1, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
        sum: outSum, // –°—É–º–º–∞

        tax: 'none', // –¢–∏–ø –Ω–∞–ª–æ–≥–∞ ("none", "vat0", "vat10", "vat20" –∏ —Ç. –¥.)
      },
    ],
  };

  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —á–µ–∫ –≤ JSON-—Å—Ç—Ä–æ–∫—É
  const receiptString = JSON.stringify(receipt);
  console.log(receiptString);

  // URL-–∫–æ–¥–∏—Ä—É–µ–º –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏
  const encodedReceiptForSignature = encodeURIComponent(receiptString);

  // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ (SignatureValue)
  const signatureString = `${merchantLogin}:${outSum}:${invId}:${encodedReceiptForSignature}:${password1}`;
  const signatureValue = crypto.createHash('md5').update(signatureString).digest('hex');

  // –î–≤–∞–∂–¥—ã URL-–∫–æ–¥–∏—Ä—É–µ–º —á–µ–∫ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ —Å—Å—ã–ª–∫–µ
  const doubleEncodedReceipt = encodeURIComponent(encodedReceiptForSignature);

  // –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è –æ–ø–ª–∞—Ç—ã
  let paymentLink = `https://auth.robokassa.ru/Merchant/Index.aspx?MerchantLogin=${merchantLogin}&OutSum=${outSum}&InvoiceID=${invId}&Description=${encodeURIComponent(
    description
  )}&SignatureValue=${signatureValue}&Receipt=${doubleEncodedReceipt}&Encoding=utf-8&Culture=ru`;

  // –í–∫–ª—é—á–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
  if (isTest) {
    paymentLink += '&IsTest=1';
  }

  return paymentLink;
}

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

// –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ

bot.onText(/\/location/, async (msg) => {
  const chatId = msg.chat.id;

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
  await bot.sendMessage(chatId, '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–≤–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ', {
    reply_markup: {
      keyboard: [
        [
          {
            text: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ',
            request_location: true, // –≠—Ç–æ –∑–∞–ø—Ä–æ—Å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
          },
        ],
      ],
      resize_keyboard: true,
      one_time_keyboard: true,
    },
  });
});
bot.on('location', async (msg) => {
  const chatId = msg.chat.id;
  const { latitude, longitude } = msg.location;
  console.log('locaton');
  if (!collectionUser) {
    return;
  }
  const user = await collectionUser.findOne({ userId: chatId });
  if (!user) {
    return;
  }
  if (user.processType === 'send_location') {
    const availableTimes = await getAvailableShippingTime(user);
    const address = await getAddressFromCoordinates(latitude, longitude);
    if (
      address !==
      '–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –º—ã –Ω–µ –º–æ–∂–µ–º –Ω–∞–π—Ç–∏ –≤–∞—à –∞–¥—Ä–µ—Å. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∞–¥—Ä–µ—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ú–æ—Å–∫–≤–µ –∏ –≤—ã —É–∫–∞–∑—ã–≤–∞–µ—Ç–µ —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.'
    ) {
      console.log(address);
      await bot.sendMessage(
        chatId,
        `–í–∞—à –∞–¥—Ä–µ—Å: ${address}\n` + '–¢–µ–ø–µ—Ä—å —É–∫–∞–∂–∏—Ç–µ –ø—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏',
        {
          reply_markup: {
            keyboard: [...availableTimes, ['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        }
      );
      await collectionUser.updateOne(
        { userId: chatId },
        { $set: { address, processType: 'select_time' } }
      );
    } else {
      await bot.sendMessage(chatId, address);
    }
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  }

  //   bot.sendLocation(chatId, latitude, longitude);
});
// import { getDistance } from "geolib";
// bot.onText(/\/noob/, async (msg) => {
//   async function getCoordinates(address) {
//     const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(
//       address
//     )}&format=json&limit=1`;
//     const response = await axios.get(url);

//     if (response.data.length === 0) {
//       throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞: ${address}`);
//     }

//     const { lat, lon } = response.data[0];
//     return { latitude: parseFloat(lat), longitude: parseFloat(lon) };
//   }

//   async function calculateDistance(address1, address2) {
//     try {
//       const coord1 = await getCoordinates(address1);
//       const coord2 = await getCoordinates(address2);

//       const distanceMeters = getDistance(coord1, coord2);
//       const distanceKm = distanceMeters / 1000;

//       console.log(`–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${distanceKm.toFixed(2)} –∫–º`);
//       return distanceKm;
//     } catch (error) {
//       console.error("–û—à–∏–±–∫–∞:", error.message);
//     }
//   }

//   // –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
//   calculateDistance(" —Ä—É–Ω–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ—É–ª–æ–∫ 8—Å1", " –ø–æ–¥–æ–ª—å—Å–∫–∏—Ö –∫—É—Ä—Å–∞–Ω—Ç–æ–≤ 10");
// });
bot.onText(/\/start/, async (msg) => {
  const chatId = msg.chat.id;
  console.log(chatId, 'chatId');
  const chatType = msg.chat.type; // 'private', 'group', 'supergroup'
  if (chatType === 'supergroup') {
    return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã –≤ –≥—Ä—É–ø–ø–µ
  }

  if (!collectionUser) {
    return;
  }
  const currentUser = await collectionUser.findOne({ userId: chatId });
  if (!currentUser) {
    await collectionUser.updateOne(
      { userId: chatId },
      {
        $set: {
          isInProcess: false,
          step: null,
          processType: null,
          photo: null,
          price: null,
        },
      },
      { upsert: true }
    );
  }
  if (currentUser && currentUser.isInProcess) {
    await bot.sendMessage(chatId, '–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –Ω–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç–µ —Ç–µ–∫—É—â–µ–µ.');
    return;
  }
  // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Markdown
  bot.setMyCommands([
    {
      command: '/menu',
      description: '–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∞—Å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',
    },
  ]);
  console.log('start');

  await bot.sendMessage(
    chatId,
    '*–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à —Ü–≤–µ—Ç–æ—á–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω!* üíê\n\n' +
      'üå∑ –ó–¥–µ—Å—å –≤—ã –Ω–∞–π–¥–µ—Ç–µ —Å–≤–µ–∂–∏–µ —Ü–≤–µ—Ç—ã –∏ —Å—Ç–∏–ª—å–Ω—ã–µ –±—É–∫–µ—Ç—ã.\n' +
      'üöÄ –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø—Ä—è–º–æ –∫ –≤–∞–º!\n\n' +
      '–ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑, –≤—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π —Ä–∞–∑–¥–µ–ª –≤ –º–µ–Ω—é. \n\n' +
      '_–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –≤—ã–±–∏—Ä–∞–µ—Ç–µ –Ω–∞—Å!_ ‚ù§Ô∏è',
    { parse_mode: 'Markdown' }
  );

  // –°–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
  await bot.sendMessage(chatId, '–ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?', {
    reply_markup: {
      keyboard: [
        ['–û–Ω–ª–∞–π–Ω-–≤–∏—Ç—Ä–∏–Ω–∞', '–ù–∞—à –∫–∞—Ç–∞–ª–æ–≥'],
        ['–û –Ω–∞—Å', '–ú—ã –Ω–∞ –∫–∞—Ä—Ç–µ', '–ù–∞—à —Å–∞–π—Ç'], // –ö–Ω–æ–ø–∫–∏ –≤ –æ–¥–Ω–æ–º —Ä—è–¥—É
        ['–ü–æ–¥–¥–µ—Ä–∂–∫–∞'],
      ],
      resize_keyboard: true, // –î–µ–ª–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º–∏
      one_time_keyboard: true, // –£–±–∏—Ä–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è
    },
  });
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /add
bot.onText(/\/add/, async (msg) => {
  const chatId = msg.chat.id;
  const userId = msg.from.id;
  const chatType = msg.chat.type; // 'private', 'group', 'supergroup'
  if (chatType === 'supergroup') {
    return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã –≤ –≥—Ä—É–ø–ø–µ
  }
  if (!collectionUser) {
    return;
  }
  if (
    userId !== 833391720 &&
    userId !== 6103809590 &&
    userId !== 5600075299 &&
    userId !== 1941288913 &&
    userId !== 5557790556 &&
    userId !== 1218030672
  ) {
    return;
  }
  const user = await collectionUser.findOne({ userId });

  if (user && user.isInProcess) {
    await bot.sendMessage(
      chatId,
      '–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –Ω–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç–µ —Ç–µ–∫—É—â–µ–µ.',
      {
        reply_markup: {
          keyboard: [['–ù–∞–∑–∞–¥']],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      }
    );
    return;
  }
  const message = await startAddProcess(userId, collectionUser);

  await bot.sendMessage(chatId, message, {
    reply_markup: {
      keyboard: [['–ù–∞–∑–∞–¥']],
      resize_keyboard: true,
      one_time_keyboard: true,
    },
  });
});

bot.onText(/\/–î–æ–±–∞–≤–∏—Ç—å–ö–∞—Ç–µ–≥–æ—Ä–∏—é/, async (msg) => {
  const chatId = msg.chat.id;
  const userId = msg.from.id;
  const chatType = msg.chat.type; // 'private', 'group', 'supergroup'
  if (chatType === 'supergroup') {
    return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã –≤ –≥—Ä—É–ø–ø–µ
  }
  if (!collectionUser || !collectionCategory) {
    return;
  }
  if (
    userId !== 833391720 &&
    userId !== 6103809590 &&
    userId !== 5600075299 &&
    userId !== 1941288913 &&
    userId !== 5557790556 &&
    userId !== 1218030672
  ) {
    return;
  }
  const user = await collectionUser.findOne({ userId });
  if (user && user.isInProcess) {
    await bot.sendMessage(
      chatId,
      '–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –Ω–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç–µ —Ç–µ–∫—É—â–µ–µ.',
      {
        reply_markup: {
          keyboard: [['–ù–∞–∑–∞–¥']],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      }
    );
    return;
  }
  try {
    const slidesFor4k = await collectionCategory.findOne({
      'categoryInfo.id': '1',
    });
    const slidesFor7k = await collectionCategory.findOne({
      'categoryInfo.id': '2',
    });
    const slidesFor10k = await collectionCategory.findOne({
      'categoryInfo.id': '3',
    });
    const slidesFor14k = await collectionCategory.findOne({
      'categoryInfo.id': '4',
    });

    await collectionUser.updateOne(
      { userId },
      {
        $set: {
          isInProcess: true,

          categoryProcessType: 'add',
        },
      },
      { upsert: true }
    );
    await bot.sendMessage(chatId, '–£–∫–∞–∂–∏—Ç–µ –≤ –∫–∞–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä', {
      reply_markup: {
        keyboard: [
          [slidesFor4k.categoryInfo.name, slidesFor7k.categoryInfo.name],
          [slidesFor14k.categoryInfo.name, slidesFor10k.categoryInfo.name],
          ['–ù–∞–∑–∞–¥'],
        ],
        resize_keyboard: true,
        one_time_keyboard: true,
      },
    });
    await collectionUser.updateOne(
      { userId },
      { $set: { isInProcess: true, processType: 'add_category' } }
    );
  } catch (err) {
    console.log('EEEEE', err);
  }
});

bot.onText(/\/–ò–∑–º–µ–Ω–∏—Ç—å–ö–∞—Ç–µ–≥–æ—Ä–∏—é/, async (msg) => {
  const chatId = msg.chat.id;
  const userId = msg.from.id;
  const chatType = msg.chat.type; // 'private', 'group', 'supergroup'
  if (chatType === 'supergroup') {
    return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã –≤ –≥—Ä—É–ø–ø–µ
  }
  if (!collectionUser || !collectionCategory) {
    return;
  }
  if (
    userId !== 833391720 &&
    userId !== 6103809590 &&
    userId !== 5600075299 &&
    userId !== 1941288913 &&
    userId !== 5557790556 &&
    userId !== 1218030672
  ) {
    return;
  }
  const user = await collectionUser.findOne({ userId });

  if (user && user.isInProcess) {
    await bot.sendMessage(
      chatId,
      '–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –Ω–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç–µ —Ç–µ–∫—É—â–µ–µ.',
      {
        reply_markup: {
          keyboard: [['–ù–∞–∑–∞–¥']],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      }
    );
    return;
  }
  try {
    const slidesFor4k = await collectionCategory.findOne({
      'categoryInfo.id': '1',
    });
    const slidesFor7k = await collectionCategory.findOne({
      'categoryInfo.id': '2',
    });
    const slidesFor10k = await collectionCategory.findOne({
      'categoryInfo.id': '3',
    });
    const slidesFor14k = await collectionCategory.findOne({
      'categoryInfo.id': '4',
    });

    await collectionUser.updateOne(
      { userId },
      {
        $set: {
          isInProcess: true,
          step: 'getCategoryName',
          categoryProcessType: 'add',
        },
      },
      { upsert: true }
    );
    await bot.sendMessage(chatId, '–£–∫–∞–∂–∏—Ç–µ –∫–∞–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å', {
      reply_markup: {
        keyboard: [
          [slidesFor4k.categoryInfo.name, slidesFor7k.categoryInfo.name],
          [slidesFor14k.categoryInfo.name, slidesFor10k.categoryInfo.name],
          ['–ù–∞–∑–∞–¥'],
        ],
        resize_keyboard: true,
        one_time_keyboard: true,
      },
    });
  } catch (err) {
    console.log('EEEEE', err);
  }
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /edit
bot.onText(/\/edit/, async (msg) => {
  const chatId = msg.chat.id;
  const userId = msg.from.id;
  const chatType = msg.chat.type; // 'private', 'group', 'supergroup'
  if (chatType === 'supergroup') {
    return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã –≤ –≥—Ä—É–ø–ø–µ
  }
  if (!collectionUser) {
    return;
  }
  if (
    userId !== 833391720 &&
    userId !== 6103809590 &&
    userId !== 5600075299 &&
    userId !== 1941288913 &&
    userId !== 5557790556 &&
    userId !== 1218030672
  ) {
    return;
  }
  const user = await collectionUser.findOne({ userId });
  if (user && user.isInProcess) {
    await bot.sendMessage(chatId, '–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –Ω–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç–µ —Ç–µ–∫—É—â–µ–µ.');
    return;
  }
  const message = await startEditProcess(userId, collectionUser);

  await bot.sendMessage(chatId, message, {
    reply_markup: {
      keyboard: [['–ù–∞–∑–∞–¥']],
      resize_keyboard: true,
      one_time_keyboard: true,
    },
  });
});

bot.onText(/\/delete/, async (msg) => {
  const chatId = msg.chat.id;
  const userId = msg.from.id;
  const chatType = msg.chat.type; // 'private', 'group', 'supergroup'
  if (chatType === 'supergroup') {
    return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã –≤ –≥—Ä—É–ø–ø–µ
  }
  if (!collectionUser) {
    return;
  }
  if (
    userId !== 833391720 &&
    userId !== 6103809590 &&
    userId !== 5600075299 &&
    userId !== 1941288913 &&
    userId !== 5557790556 &&
    userId !== 1218030672
  ) {
    return;
  }
  const user = await collectionUser.findOne({ userId });
  if (user && user.isInProcess) {
    await bot.sendMessage(chatId, '–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –Ω–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç–µ —Ç–µ–∫—É—â–µ–µ.');
    return;
  }
  await bot.sendMessage(chatId, '–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —Ç–æ–≤–∞—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å.', {
    reply_markup: {
      keyboard: [['–ù–∞–∑–∞–¥']],
      resize_keyboard: true,
      one_time_keyboard: true,
    },
  });
  await collectionUser.updateOne(
    { userId },
    {
      $set: {
        isInProcess: true,
        processType: 'delete',
      },
    },
    { upsert: true }
  );

  // collectionProduct
  //   .find()
  //   .skip(index)
  //   .limit(1)
  //   .toArray()
  //   .then((docs) => {
  //     if (docs.length > 0) {
  //       collectionProduct.deleteOne({ _id: docs[0]._id });
  //       :–£–¥–∞–ª–µ–Ω –¥–æ–∫—É–º–µ–Ω—Ç —Å _id:", docs[0]._id);
  //     } else {
  //       console.log("–î–æ–∫—É–º–µ–Ω—Ç —Å —Ç–∞–∫–∏–º –∏–Ω–¥–µ–∫—Å–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω");
  //     }
  //   });
});

bot.onText(/^\/reply (\d+) (.+)/s, async (msg, match) => {
  const adminId = msg.from.id;
  const userId = parseInt(match[1]); // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const replyText = match[2]; // –û—Ç–≤–µ—Ç –æ—Ç –∞–¥–º–∏–Ω–∞

  try {
    // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–∞–∑—ã
    const user = await collectionUser.findOne({ userId });

    if (!user) {
      return await bot.sendMessage(adminId, '‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.');
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤ —Ä–∞–∑–¥–µ–ª–µ –ª–∏ –æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∫–∏
    if (user.processType === 'support') {
      await bot.sendMessage(userId, `üì¨ –û—Ç–≤–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏:\n\n${replyText}`);
    } else {
      await bot.sendMessage(
        -1002572728889,
        `‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –∞–π–¥–∏ ${userId} –Ω–µ –≤ —Ä–∞–∑–¥–µ–ª–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏.`
      );
    }
  } catch (err) {
    await bot.sendMessage(-1002572728889, `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: ${err.message}`);
  }
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
bot.on('text', async (msg) => {
  const chatId = msg.chat.id;
  const userId = msg.from.id;
  const text = msg.text.trim();
  try {
    if (!collectionUser) {
      return;
    }
    const chatType = msg.chat.type; // 'private', 'group', 'supergroup'
    if (chatType === 'supergroup') {
      return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã –≤ –≥—Ä—É–ø–ø–µ
    }
    const user = await collectionUser.findOne({ userId });
    if (text === '–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é' && user.processType === 'finished') {
      await collectionUser.updateOne(
        { userId },
        { $set: { isInProcess: false, processType: null } }
      );

      await bot.sendMessage(chatId, '–í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.', {
        reply_markup: {
          keyboard: [
            ['–û–Ω–ª–∞–π–Ω-–≤–∏—Ç—Ä–∏–Ω–∞', '–ù–∞—à –∫–∞—Ç–∞–ª–æ–≥'],
            ['–û –Ω–∞—Å', '–ú—ã –Ω–∞ –∫–∞—Ä—Ç–µ', '–ù–∞—à —Å–∞–π—Ç'],
            ['–ü–æ–¥–¥–µ—Ä–∂–∫–∞'],
          ],
          resize_keyboard: true, // –î–µ–ª–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º–∏
          one_time_keyboard: true, // –£–±–∏—Ä–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è
        },
      });
      await collectionUser.updateOne(
        { userId },
        { $set: { isInProcess: false, processType: null } }
      );
      return;
    }

    if (user && user.isInProcess && user.processType === 'add_category') {
      if (text !== '–ù–∞–∑–∞–¥') {
        const selectedCategory = await collectionCategory.findOne({
          'categoryInfo.name': text,
        });
        if (!selectedCategory) {
          await bot.sendMessage(chatId, '–¢–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', {
            reply_markup: {
              keyboard: [['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          });
          return;
        }
        await collectionUser.updateOne(
          { userId },
          { $set: { processType: 'add_category_item_photo', addCategoryName: text } }
        );
        await bot.sendMessage(chatId, '–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é —Ç–æ–≤–∞—Ä–∞', {
          reply_markup: {
            keyboard: [['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
      }
    }

    if (user && user.isInProcess && user.step === 'getCategoryName') {
      const slidesFor4k = await collectionCategory.findOne({
        'categoryInfo.id': '1',
      });
      const slidesFor7k = await collectionCategory.findOne({
        'categoryInfo.id': '2',
      });
      const slidesFor10k = await collectionCategory.findOne({
        'categoryInfo.id': '3',
      });
      const slidesFor14k = await collectionCategory.findOne({
        'categoryInfo.id': '4',
      });
      if (
        slidesFor4k.categoryInfo.name !== text &&
        slidesFor7k.categoryInfo.name !== text &&
        slidesFor10k.categoryInfo.name !== text &&
        slidesFor14k.categoryInfo.name !== text &&
        text !== '–ù–∞–∑–∞–¥'
      ) {
        await collectionUser.updateOne({ userId }, { $set: { step: 'getCategoryName' } });
        bot.sendMessage(chatId, '–¢–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', {
          reply_markup: {
            keyboard: [
              [slidesFor4k.categoryInfo.name, slidesFor7k.categoryInfo.name],
              [slidesFor14k.categoryInfo.name, slidesFor10k.categoryInfo.name],
              ['–ù–∞–∑–∞–¥'],
            ],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        return;
      }
      if (text !== '–ù–∞–∑–∞–¥') {
        await collectionUser.updateOne(
          { userId },
          { $set: { step: 'getCategoryItemName', categoryName: text } }
        );
        bot.sendMessage(chatId, '–í—ã —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏?', {
          reply_markup: {
            keyboard: [['–î–∞', '–ù–µ—Ç']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
      }
    }

    if (text === '–ù–∞–∑–∞–¥' && user.processType && user.processType === 'support') {
      console.log('user –≤—ã—à–µ–ª');
    }
    if (text === '–ü–æ–¥–¥–µ—Ä–∂–∫–∞' && !user.isInProcess) {
      console.log('user –≤ –ø–æ–¥–¥–µ—Ä–∂–∫–µ');
      await bot.sendMessage(
        chatId,
        'üìù –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É –∏–ª–∏ –≤–æ–ø—Ä–æ—Å. –ù–∞—à–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.',
        {
          reply_markup: {
            keyboard: [['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        }
      );

      await collectionUser.updateOne(
        { userId },
        { $set: { processType: 'support', isInProcess: true } }
      );
    }

    if (
      text !== '–ù–∞–∑–∞–¥' &&
      user.isInProcess &&
      user.processType === 'support' &&
      text !== '/menu'
    ) {
      try {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–∞—â–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ—Å—ã–ª–∞–µ–º –∞–¥–º–∏–Ω–∞–º
        const supportText = `‚úâÔ∏è –ù–æ–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
  ID: ${userId}
  –ò–º—è: ${msg.from.first_name}
  –Æ–∑–µ—Ä–Ω–µ–π–º: @${msg.from.username || '–Ω–µ—Ç'}

  –°–æ–æ–±—â–µ–Ω–∏–µ: ${text}`;

        const ADMIN_CHAT_ID = -1002572728889;

        await bot.sendMessage(ADMIN_CHAT_ID, supportText);
        await bot.sendMessage(chatId, '–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–Ω–æ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É. –û–∂–∏–¥–∞–π—Ç–µ –æ—Ç–≤–µ—Ç–∞.');
      } catch (error) {
        await bot.sendMessage(ADMIN_CHAT_ID, '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è ');
        await bot.sendMessage(chatId, '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è');
      }
    }

    if (text === '–ù–∞–∑–∞–¥' && user.processType !== 'finished') {
      if (
        (user && user.processType === 'catalog_price=4000') ||
        (user && user.processType === 'catalog_price=8000') ||
        (user && user.processType === 'catalog_price=10000') ||
        (user && user.processType === 'catalog_price=10000++')
      ) {
        const slidesFor4k = await collectionCategory.findOne({
          'categoryInfo.id': '1',
        });
        const slidesFor7k = await collectionCategory.findOne({
          'categoryInfo.id': '2',
        });
        const slidesFor10k = await collectionCategory.findOne({
          'categoryInfo.id': '3',
        });
        const slidesFor14k = await collectionCategory.findOne({
          'categoryInfo.id': '4',
        });
        const message = await cancelProcess(userId, collectionUser);

        const user = await collectionUser.findOne({ userId });
        if (!user) {
          return;
        }
        const deletedPhotoIds = user.photo_to_delete;
        if (deletedPhotoIds && deletedPhotoIds.length > 0) {
          deletedPhotoIds.forEach((photoId) => {
            bot.deleteMessage(chatId, photoId);
          });
        }

        await bot.sendMessage(chatId, message, {
          reply_markup: {
            keyboard: [
              [slidesFor4k.categoryInfo.name, slidesFor7k.categoryInfo.name],
              [slidesFor14k.categoryInfo.name, slidesFor10k.categoryInfo.name],
              ['–ù–∞–∑–∞–¥'],
            ],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        await collectionUser.updateOne(
          { userId },
          { $set: { message_to_delete: null, photo_to_delete: [] } }
        );
        return;
      }
      if (user && user.processType && user.processType === 'payment') {
        const message = await cancelProcess(userId, collectionUser);
        await bot.sendMessage(chatId, message, {
          reply_markup: {
            keyboard: [['–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ'], ['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        return;
      }
      if (user && user.processType && user.processType === 'prepare_payment') {
        const message = await cancelProcess(userId, collectionUser);
        await bot.sendMessage(chatId, message, {
          reply_markup: {
            keyboard: [['–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ'], ['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        return;
      }
      if (user && user.processType && user.processType === 'select_date') {
        const message = await cancelProcess(userId, collectionUser);
        const user = await collectionUser.findOne({ userId });
        if (!user) {
          return;
        }
        await bot.sendMessage(chatId, message, {
          reply_markup: {
            keyboard: [
              ['–û–Ω–ª–∞–π–Ω-–≤–∏—Ç—Ä–∏–Ω–∞', '–ù–∞—à –∫–∞—Ç–∞–ª–æ–≥'],
              ['–û –Ω–∞—Å', '–ú—ã –Ω–∞ –∫–∞—Ä—Ç–µ', '–ù–∞—à —Å–∞–π—Ç'],
              ['–ü–æ–¥–¥–µ—Ä–∂–∫–∞'],
            ],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        const deletedPhotoIds = user.photo_to_delete;
        if (deletedPhotoIds && deletedPhotoIds.length > 0) {
          deletedPhotoIds.forEach((photoId) => {
            bot.deleteMessage(chatId, photoId);
          });
        }
        if (Array.isArray(user.message_to_delete) && user.message_to_delete.length > 0) {
          for (const messageId of user.message_to_delete) {
            console.log('delete message on nazad');
            await bot.deleteMessage(chatId, messageId);
          }
        } else if (typeof user.message_to_delete === 'number') {
          console.log('delete message on nazad2');

          await bot.deleteMessage(chatId, user.message_to_delete);
        }
        await collectionUser.updateOne(
          { userId },
          { $set: { message_to_delete: null, photo_to_delete: [] } }
        );
        return;
      }
      if (user && user.processType && user.processType === 'who_is_client') {
        const message = await cancelProcess(userId, collectionUser);
        await bot.sendMessage(chatId, message, {
          reply_markup: {
            keyboard: [['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        return;
      }
      if (user && user.processType && user.processType === 'client_number') {
        const message = await cancelProcess(userId, collectionUser);
        const availableTimes = getAvailableShippingTime(user);
        await bot.sendMessage(chatId, message, {
          reply_markup: {
            keyboard: [...availableTimes, ['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        return;
      }
      if (
        user &&
        user.processType &&
        user.processType === 'recipient_number' &&
        (user.whoIsClient === '–î—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫' || user.whoIsClient === '2')
      ) {
        const message = await cancelProcess(userId, collectionUser);
        await bot.sendMessage(chatId, message, {
          reply_markup: {
            keyboard: [['–Ø', '–î—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫'], ['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        return;
      }
      if (user && user.processType && user.processType === 'extra_information') {
        console.log('exit');

        const message = await cancelProcess(userId, collectionUser);
        await bot.sendMessage(chatId, message, {
          reply_markup: {
            keyboard: [['–ü–µ—Ä–µ–π—Ç–∏ –¥–∞–ª—å—à–µ'], ['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        return;
      }
      if (
        user &&
        user.processType &&
        user.processType === 'postcard' &&
        user.address === '–°–∞–º–æ–≤—ã–≤–æ–∑'
      ) {
        console.log('exit –≥–¥–µ –Ω—É–∂–Ω–æ');

        const message = await cancelProcess(userId, collectionUser);
        await bot.sendMessage(chatId, message, {
          reply_markup: {
            keyboard: [['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        return;
      }
      if (
        user &&
        user.processType &&
        user.processType === 'postcard' &&
        (user.whoIsClient === '–Ø' || user.whoIsClient === '1')
      ) {
        const message = await cancelProcess(userId, collectionUser);
        await bot.sendMessage(chatId, message, {
          reply_markup: {
            keyboard: [['–Ø', '–î—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫'], ['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        return;
      }
      if (
        user &&
        user.processType &&
        user.processType === 'recipient_number' &&
        user.address !== '–°–∞–º–æ–≤—ã–≤–æ–∑'
      ) {
        const message = await cancelProcess(userId, collectionUser);
        const availableTimes = getAvailableShippingTime(user);

        await bot.sendMessage(chatId, message, {
          reply_markup: {
            keyboard: [...availableTimes, ['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        return;
      }
      if (
        user &&
        user.processType &&
        user.processType === 'postcard' &&
        (user.whoIsClient === '–î—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫' ||
          user.whoIsClient === '–Ø' ||
          user.whoIsClient === '1' ||
          user.whoIsClient === '2')
      ) {
        const message = await cancelProcess(userId, collectionUser);
        await bot.sendMessage(chatId, message, {
          reply_markup: {
            keyboard: [['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        return;
      }
      if (
        (user && user.processType && user.processType === 'send_location') ||
        (user && user.processType && user.processType === 'enter_address') ||
        (user && user.processType && user.processType === 'select_time')
      ) {
        const message = await cancelProcess(userId, collectionUser);
        await bot.sendMessage(chatId, message, {
          reply_markup: {
            keyboard: [['–í–≤–µ—Å—Ç–∏ –∞–¥—Ä–µ—Å', '–°–∞–º–æ–≤—ã–≤–æ–∑'], ['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        return;
      } else {


        const message = await cancelProcess(userId, collectionUser);
        const user = await collectionUser.findOne({ userId });
        if (!user) {
          return;
        }
        const deletedPhotoIds = await user.photo_to_delete;
        if (deletedPhotoIds && deletedPhotoIds.length > 0) {
          deletedPhotoIds.forEach((photoId) => {
            bot.deleteMessage(chatId, photoId);
          });
        }
        if (Array.isArray(user.message_to_delete) && user.message_to_delete.length > 0) {
          for (const messageId of user.message_to_delete) {
            console.log('delete message on nazad');
            await bot.deleteMessage(chatId, messageId);
          }
        } else if (typeof user.message_to_delete === 'number') {
          console.log('delete message on nazad2');

          await bot.deleteMessage(chatId, user.message_to_delete);
        }

        await collectionUser.updateOne(
          { userId },
          { $set: { photo_to_delete: [], message_to_delete: null } }
        );
        await bot.sendMessage(chatId, message, {
          reply_markup: {
            keyboard: [
              ['–û–Ω–ª–∞–π–Ω-–≤–∏—Ç—Ä–∏–Ω–∞', '–ù–∞—à –∫–∞—Ç–∞–ª–æ–≥'],
              ['–û –Ω–∞—Å', '–ú—ã –Ω–∞ –∫–∞—Ä—Ç–µ', '–ù–∞—à —Å–∞–π—Ç'],
              ['–ü–æ–¥–¥–µ—Ä–∂–∫–∞'],
            ],
            resize_keyboard: true, // –î–µ–ª–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º–∏
            one_time_keyboard: true, // –£–±–∏—Ä–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è
          },
        });
      }
    }
  } catch (e) {
    console.log('Error has to fix', e);
  }
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
bot.on('photo', async (msg) => {
  const chatId = msg.chat.id;
  const userId = msg.from.id;
  if (!collectionUser) {
    return;
  }
  const user = await collectionUser.findOne({ userId });

  if (user && user.isInProcess && user.processType === 'add_category_item_photo') {
    console.log('add_category_item_photo');

    const photo = msg.photo[0].file_id;
    if (!photo) {
      await bot.sendMessage(chatId, '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é —Ç–æ–≤–∞—Ä–∞', {
        reply_markup: {
          keyboard: [['–ù–∞–∑–∞–¥']],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });
      return;
    }

    await collectionUser.updateOne(
      { userId },
      { $set: { processType: 'add_category_item_photo_description', addCategoryItemPhoto: photo } }
    );
    await bot.sendMessage(
      chatId,
      '–§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –î–æ–±–∞–≤–ª–µ–Ω–æ. –¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ. –í–Ω–∏–º–∞–Ω–∏–µ! –í –Ω–∞–∑–≤–∞–Ω–∏–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ü–µ–Ω–∞ –≤ —Ç–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:–¶–µ–Ω–∞: 2000 ‚ÇΩ',
      {
        reply_markup: {
          keyboard: [['–ù–∞–∑–∞–¥']],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      }
    );
  }

  if (user && user.isInProcess && user.step === 'getCategoryPhoto') {
    const photo = msg.photo[0].file_id;
    console.log(photo, 'photo');
    console.log(user.itemId, 'itemId');

    await collectionCategory.updateOne(
      { 'categoryItem.itemId': user.itemId },
      { $set: { 'categoryItem.$.photo': photo } }
    );
    await bot.sendMessage(
      chatId,
      '–§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ. –¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ. –í–Ω–∏–º–∞–Ω–∏–µ! –í –Ω–∞–∑–≤–∞–Ω–∏–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ü–µ–Ω–∞ –≤ —Ç–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:–¶–µ–Ω–∞: 2000 ‚ÇΩ'
    );
    await collectionUser.updateOne(
      { userId },
      {
        $set: {
          step: 'getCategorySubName',
          processType: 'update_category_name',
        },
      }
    );
  }

  if (user && user.step === 'getIndex') {
    return bot.sendMessage(
      chatId,
      '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä –ø—Ä–µ–¥–º–µ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å.'
    );
  }
  if (user && user.step !== 'getPhoto') {
    return;
  }

  const photo = msg.photo[msg.photo.length - 1];
  const fileId = photo.file_id;

  const message = await handlePhoto(userId, fileId);
  await bot.sendMessage(chatId, message);
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞)
bot.on('message', async (msg) => {
  const chatId = msg.chat.id;
  const userId = msg.from.id;
  if (!collectionUser || !collectionProduct) {
    return;
  }
  const chatType = msg.chat.type; // 'private', 'group', 'supergroup'
  if (chatType === 'supergroup') {
    return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã –≤ –≥—Ä—É–ø–ø–µ
  }

  const user = await collectionUser.findOne({ userId });
  if (!user || !user.isInProcess) {
    return; // –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
  }

  if (
    user.step === 'getPhoto' &&
    msg.text !== '–ù–∞–∑–∞–¥' &&
    msg.text &&
    msg.text !== '/add' &&
    msg.text !== '/edit'
  ) {
    setTimeout(() => bot.sendMessage(chatId, '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞.'), 300);
  } else if (
    user.step === 'getPrice' &&
    msg.text !== '–ù–∞–∑–∞–¥' &&
    msg.text &&
    msg.text !== '/add' &&
    msg.text !== '/edit' &&
    msg.text[0] !== '/'
  ) {
    const message = await handlePrice(userId, msg.text);
    if (message === '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞. –ù–∞–ø—Ä–∏–º–µ—Ä: 100, 199.99') {
      await bot.sendMessage(chatId, message, {
        reply_markup: {
          keyboard: [['–ù–∞–∑–∞–¥']],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });
    } else {
      await bot.sendMessage(chatId, message, {
        reply_markup: {
          keyboard: [
            ['–û–Ω–ª–∞–π–Ω-–≤–∏—Ç—Ä–∏–Ω–∞', '–ù–∞—à –∫–∞—Ç–∞–ª–æ–≥'],
            ['–û –Ω–∞—Å', '–ú—ã –Ω–∞ –∫–∞—Ä—Ç–µ', '–ù–∞—à —Å–∞–π—Ç'],
            ['–ü–æ–¥–¥–µ—Ä–∂–∫–∞'],
          ],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });
    }
  } else if (
    user.step === 'getIndex' &&
    msg.text !== '–ù–∞–∑–∞–¥' &&
    msg.text &&
    msg.text !== '/add' &&
    msg.text !== '/edit' &&
    msg.text[0] !== '/'
  ) {
    const message = await handleEdit(userId, msg.text);
    await bot.sendMessage(chatId, message);
  }
});

bot.on('message', async (msg) => {
  const chatId = msg.chat.id;
  const text = msg.text;
  const userId = msg.from.id;
  const chatType = msg.chat.type; // 'private', 'group', 'supergroup'
  console.log(chatType);
  try {
    if (chatType === 'supergroup') {
      return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã –≤ –≥—Ä—É–ø–ø–µ
    }
    if (!collectionUser || !collectionProduct) {
      console.log('collectionUser or collectionProduct is null');
      return;
    }
    const user = await collectionUser.findOne({ userId });
    if (text === '/menu' && user) {
      await bot.sendMessage(chatId, '–í—ã –æ—Ç–º–µ–Ω–∏–ª–∏ –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è. –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.', {
        reply_markup: {
          keyboard: [
            ['–û–Ω–ª–∞–π–Ω-–≤–∏—Ç—Ä–∏–Ω–∞', '–ù–∞—à –∫–∞—Ç–∞–ª–æ–≥'],
            ['–û –Ω–∞—Å', '–ú—ã –Ω–∞ –∫–∞—Ä—Ç–µ', '–ù–∞—à —Å–∞–π—Ç'],
            ['–ü–æ–¥–¥–µ—Ä–∂–∫–∞'],
          ],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });
      if (Array.isArray(user.message_to_delete) && user.message_to_delete.length > 0) {
        for (const messageId of user.message_to_delete) {
          try {
            await bot.deleteMessage(chatId, messageId);
          } catch (error) {
            console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è ${messageId}:`, error.message);
          }
        }
      } else if (typeof user.message_to_delete === 'number') {
        try {
          await bot.deleteMessage(chatId, user.message_to_delete);
        } catch (error) {
          console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è ${user.message_to_delete}:`, error.message);
        }
      }

      if (user.photo_to_delete) {
        user.photo_to_delete.forEach((photoId) => {
          bot.deleteMessage(chatId, photoId);
        });
      }
      await collectionUser.findOneAndUpdate(
        { userId },
        {
          $set: {
            isInProcess: false,
            processType: null,
            message_to_delete: null,
            MKAD: null,
            address: null,
            clientNumber: null,
            selectedDate: null,
            whoIsClient: null,
            currentShow: null,
            recipientNumber: null,
            photo_to_delete: [],
            time: null,
            step: null,
            addCategoryName: null,
            categoryName: null,
            categoryProcessType: null,
          },
        }
      );
      return;
    }

    if (
      !user ||
      (user.isInProcess &&
        user.processType !== 'showcase' &&
        user.processType !== 'select_date' &&
        user.processType !== 'prepare_address' &&
        user.processType !== 'send_location' &&
        user.processType !== 'enter_address' &&
        user.processType !== 'select_time' &&
        user.processType !== 'recipient_number' &&
        user.processType !== 'extra_information' &&
        user.processType !== 'catalog' &&
        user.processType !== 'catalog_price=4000' &&
        user.processType !== 'catalog_price=8000' &&
        user.processType !== 'catalog_price=15000' &&
        user.processType !== 'client_number' &&
        user.processType !== 'who_is_client' &&
        user.processType !== 'postcard' &&
        user.processType !== 'prepare_payment' &&
        user.processType !== 'delete' &&
        user.processType !== 'showcase1' &&
        user.processType !== 'showcase2' &&
        user.processType !== 'update_category_name' &&
        user.step !== 'getCategoryItemName' &&
        user.step !== 'waitForNewCategoryName' &&
        user.processType !== 'add_category_item_photo' &&
        user.processType !== 'add_category_item_photo_description' && user.processType !== "rules"&&
        user.proccesType !== "rules_text")



    ) {
      console.log('User is in process');

      return; // –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
    }
    console.log(user.step, 'user.step', text);

    const newItem = {};

if(user && user.isInProcess && user.processType === "rules" && text === "–î–∞"){
    const chatId = msg.chat.id;
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();

      const calendar = generateCalendar(year, month);
await bot.sendMessage(chatId,"–í—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ –Ω–∞—à—É –ø–æ–ª–∏—Ç–∏–∫—É",{
  reply_markup:{
    keyboard:[["–ù–∞–∑–∞–¥"]]
  }
})

      const messageWithCalendar = await bot.sendMessage(
        chatId,
        'üìÖ–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—É—é –≤–∞–º –¥–∞—Ç—É:          ',
        {
          reply_markup: {
            inline_keyboard: calendar,

            resize_keyboard: true,
          },
        }
      );
      await collectionUser.updateOne(
        { userId: chatId },
        {
          $push: {
            message_to_delete: messageWithCalendar.message_id,
          },
        }
      );
}
if(user && user.isInProcess && user.processType === "rules" && text === "–ù–µ—Ç"){
  const chatId = msg.chat.id;

       await bot.sendMessage(
        chatId,
        '–í—ã –Ω–µ –ø—Ä–∏–Ω—è–ª–∏ –Ω–∞—à—É –ø–æ–ª–∏—Ç–∏–∫—É –≤—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é  ',
        {
          reply_markup: {
            keyboard: [
            ['–û–Ω–ª–∞–π–Ω-–≤–∏—Ç—Ä–∏–Ω–∞', '–ù–∞—à –∫–∞—Ç–∞–ª–æ–≥'],
            ['–û –Ω–∞—Å', '–ú—ã –Ω–∞ –∫–∞—Ä—Ç–µ', '–ù–∞—à —Å–∞–π—Ç'],
            ['–ü–æ–¥–¥–µ—Ä–∂–∫–∞'],
          ],
            resize_keyboard: true,
          },
        }
      );
      await collectionUser.findOneAndUpdate(
        { userId },
        {
          $set: {
            isInProcess: false,
            processType: null,
            message_to_delete: null,
            MKAD: null,
            address: null,
            clientNumber: null,
            selectedDate: null,
            whoIsClient: null,
            currentShow: null,
            recipientNumber: null,
            photo_to_delete: [],
            time: null,
            step: null,
            addCategoryName: null,
            categoryName: null,
            categoryProcessType: null,
          },
        }
      );
}
if(user && user.isInProcess && user.processType === 'rules' && text === "–û–∑–Ω–∞–∫–æ–º–∏—Ç—Å—è"){
   const chatId = msg.chat.id;

      bot.sendDocument(chatId, "./–ü–æ–ª–∏—Ç–∏–∫–∞–ö–æ–Ω–¥–∏—Ñ–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏.docx", {
  caption: '–î–æ–∫—É–º–µ–Ω—Ç —Å –Ω–∞—à–µ–π –ø–æ–ª–∏—Ç–∏–∫–æ–π',
  filename: 'MyDocument.docx',
  reply_markup:{
    keyboard:[["–ù–∞–∑–∞–¥"]]
  }
}).then(async() => {
  await collectionUser.updateOne(
        { userId: chatId },
        {
          $set: {
          proccesType:"rules_text"
          },
        }
      );
  console.log('–§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
}).catch((error) => {
  console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:', error);
});
}


if(user && user.isInProcess && user.proccesType === "rules_text" && text === "–ù–∞–∑–∞–¥"){
    const chatId = msg.chat.id;

       await bot.sendMessage(
        chatId,
        '–í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ –≤—ã–±–æ—Ä',
        {
          reply_markup: {
            keyboard: [
            ['–î–∞',"–ù–µ—Ç","–û–∑–Ω–∞–∫–æ–º–∏—Ç—Å—è"],
          ],
            resize_keyboard: true,
          },
        }
      );
        await collectionUser.updateOne(
        { userId: chatId },
        {
          $set: {
          proccesType:"rules"
          },
        }
      );

}
    if (user && user.isInProcess && user.processType === 'add_category_item_photo_description') {
      if (text !== '–ù–∞–∑–∞–¥') {
        newItem.caption = text;
        const currentCategory = await collectionCategory.findOne({
          'categoryInfo.name': user.addCategoryName,
        });
        if (!currentCategory) {
          await bot.sendMessage(chatId, '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', {
            reply_markup: {
              keyboard: [['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          });
          return;
        }
        const currentCategoryItems =
          currentCategory.categoryItem[currentCategory.categoryItem.length - 1].itemId;
        const newItemId = Number(currentCategoryItems) + 1;
        newItem.itemId = String(newItemId);
        newItem.photo = user.addCategoryItemPhoto;
        await collectionCategory.updateOne(
          { 'categoryInfo.name': user.addCategoryName },
          { $push: { categoryItem: newItem } }
        );
        console.log(newItem, 'newItem');

        await bot.sendMessage(chatId, '–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é', {
          reply_markup: {
            keyboard: [['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
      }
    }

    if (text !== '–ù–∞–∑–∞–¥' && user.step === 'waitForNewCategoryName') {
      try {
        const category = await collectionCategory.findOne({
          'categoryInfo.name': user.categoryName,
        });

        if (!category) {
          await bot.sendMessage(chatId, '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', {
            reply_markup: {
              keyboard: [['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          });
          return;
        }

        await collectionCategory.updateOne(
          { 'categoryInfo.name': user.categoryName },
          { $set: { 'categoryInfo.name': text } }
        );

        await bot.sendMessage(chatId, '–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ. –í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é', {
          reply_markup: {
            keyboard: [
              ['–û–Ω–ª–∞–π–Ω-–≤–∏—Ç—Ä–∏–Ω–∞', '–ù–∞—à –∫–∞—Ç–∞–ª–æ–≥'],
              ['–û –Ω–∞—Å', '–ú—ã –Ω–∞ –∫–∞—Ä—Ç–µ', '–ù–∞—à —Å–∞–π—Ç'],
              ['–ü–æ–¥–¥–µ—Ä–∂–∫–∞'],
            ],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });

        await collectionUser.updateOne(
          { userId },
          { $set: { step: null, categoryName: null, isInProcess: false, processType: null } }
        );
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', error);
        await bot.sendMessage(
          chatId,
          '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.',
          {
            reply_markup: {
              keyboard: [['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          }
        );
      }
    }

    if (text !== '–ù–∞–∑–∞–¥' && user.step === 'getCategoryItemName' && text === '–î–∞') {
      await bot.sendMessage(chatId, '–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', {
        reply_markup: {
          keyboard: [['–ù–∞–∑–∞–¥']],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });
      await collectionUser.updateOne(
        { userId },
        {
          $set: { step: 'waitForNewCategoryName' },
        }
      );
    }
    if (text !== '–ù–∞–∑–∞–¥' && user.step === 'getCategoryItemName' && text === '–ù–µ—Ç') {
      console.log('getCategoryItemName');

      const slidesFor4k = await collectionCategory.findOne({
        'categoryInfo.id': '1',
      });
      const slidesFor7k = await collectionCategory.findOne({
        'categoryInfo.id': '2',
      });
      const slidesFor10k = await collectionCategory.findOne({
        'categoryInfo.id': '3',
      });
      const slidesFor14k = await collectionCategory.findOne({
        'categoryInfo.id': '4',
      });
      if (
        slidesFor4k.categoryInfo.name === user.categoryName ||
        slidesFor7k.categoryInfo.name === user.categoryName ||
        slidesFor10k.categoryInfo.name === user.categoryName ||
        slidesFor14k.categoryInfo.name === user.categoryName
      ) {
        const selectedCategory = await collectionCategory.findOne({
          'categoryInfo.name': user.categoryName,
        });

        await selectedCategory.categoryItem.forEach(async (item, index) => {
          const sentMessage = await bot.sendPhoto(chatId, item.photo, {
            caption: item.caption,
            parse_mode: 'Markdown',
            reply_markup: {
              inline_keyboard: [
                [
                  {
                    text: '–ò–∑–º–µ–Ω–∏—Ç—å',
                    callback_data: `update_category_${item.itemId}`,
                  },
                ],
              ],
            },
          });
          await collectionUser.updateOne(
            { userId },
            {
              $push: { photo_to_delete: sentMessage.message_id },
              $set: { step: 'getCategoryId' },
            }
          );
        });
      }
    }

    if (text !== '–ù–∞–∑–∞–¥' && user.processType === 'update_category_name') {
      await collectionCategory.updateOne(
        { 'categoryItem.itemId': user.itemId },
        {
          $set: {
            'categoryItem.$.caption': text,
          },
        }
      );
      await collectionUser.updateOne(
        { userId },
        {
          $set: {
            isInProcess: false,
            processType: null,
            step: null,
            categoryName: null,
          },
        }
      );
      await bot.sendMessage(chatId, '–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ. –í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é', {
        reply_markup: {
          keyboard: [
            ['–û–Ω–ª–∞–π–Ω-–≤–∏—Ç—Ä–∏–Ω–∞', '–ù–∞—à –∫–∞—Ç–∞–ª–æ–≥'],
            ['–û –Ω–∞—Å', '–ú—ã –Ω–∞ –∫–∞—Ä—Ç–µ', '–ù–∞—à —Å–∞–π—Ç'],
            ['–ü–æ–¥–¥–µ—Ä–∂–∫–∞'],
          ],
          resize_keyboard: true, // –î–µ–ª–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º–∏
          one_time_keyboard: true, // –£–±–∏—Ä–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è
        },
      });
    }

    if (user.processType === 'delete') {
      const index = parseInt(text, 10);
      if ((isNaN(index) && text !== '–ù–∞–∑–∞–¥') || (index <= 0 && text !== '–ù–∞–∑–∞–¥')) {
        await bot.sendMessage(chatId, '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–æ–≤–∞—Ä–∞:');
        return;
      }
      collectionProduct
        .find()
        .skip(index - 1)
        .limit(1)
        .toArray()
        .then(async (docs) => {
          if (docs.length > 0) {
            collectionProduct.deleteOne({ _id: docs[0]._id });
            console.log('–£–¥–∞–ª–µ–Ω –¥–æ–∫—É–º–µ–Ω—Ç —Å _id:', docs[0]._id);
            await bot.sendMessage(chatId, '–í—ã –≤–≤–µ–ª–∏ –∏–Ω–¥–µ–∫—Å, —Ç–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω. –í—ã –≤—ã—à–ª–∏ –∏–∑ –¥–µ–π—Å—Ç–≤–∏—è', {
              reply_markup: {
                resize_keyboard: true,
                one_time_keyboard: true,
              },
            });
            await collectionUser.updateOne(
              { userId },
              { $set: { isInProcess: false, processType: null } }
            );
          } else {
            console.log('–î–æ–∫—É–º–µ–Ω—Ç —Å —Ç–∞–∫–∏–º –∏–Ω–¥–µ–∫—Å–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω');
          }
        });

      return;
    }

    if (text === '–û–Ω–ª–∞–π–Ω-–≤–∏—Ç—Ä–∏–Ω–∞' && !user.isInProcess) {
      const products = await collectionProduct.find({ photo: { $exists: true } }).toArray();

      const count = await collectionProduct.countDocuments({
        photo: { $exists: true },
      });
      if (count === 0) {
        await bot.sendMessage(chatId, '–ù–µ—Ç —Ñ–æ—Ç–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.');
        return;
      }
      const keyboardText = await products
        .slice(0, 10)
        .map((product, index) => [
          `‚Ññ${index + 1} ${product.price ? `${product.price} ‚ÇΩ` : '–ë–µ–∑ —Ü–µ–Ω—ã'}`,
        ]);
      keyboardText.push(['–ù–∞–∑–∞–¥']);
      await bot.sendMessage(chatId, '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à—É –æ–Ω–ª–∞–π–Ω-–≤–∏—Ç—Ä–∏–Ω—É!', {
        reply_markup: {
          keyboard: keyboardText,
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });
      const mediaGroup = await products
        .filter((product) => product.photo)
        .map((product, index) => ({
          type: 'photo',
          media: product.photo,
          caption: `‚Ññ${index + 1}: ${product.price || '–ë–µ–∑ —Ü–µ–Ω—ã'} ‚ÇΩ`,
        }))
        .slice(0, 10);

      const messagePhotos = await bot.sendMediaGroup(chatId, mediaGroup);
      console.log(
        'messagePhotos',
        messagePhotos.map((item) => item.message_id)
      );
      const photoIds = messagePhotos.map((item) => item.message_id);
      await collectionUser.updateOne(
        { userId },
        {
          $set: { processType: 'showcase', isInProcess: true, currentIndex: 0 },
          $push: {
            photo_to_delete: { $each: photoIds },
          },
        }
      );

      console.log('count', count);

      if (count > 10) {
        const keyboard = [
          {
            text: '–°–º–æ—Ç—Ä–µ—Ç—å –¥–∞–ª—å—à–µ',
            callback_data: 'nextt_product_10',
          },
        ];

        const messageWelcome = await bot.sendMessage(
          chatId,
          '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–ª–∞–π–¥—É:',
          {
            reply_markup: {
              inline_keyboard: [keyboard],
            },
          }
        );
        await collectionUser.updateOne(
          { userId: chatId },
          {
            $set: {
              message_to_delete: [messageWelcome.message_id],
            },
          }
        );
      }
    } else if (text.startsWith('‚Ññ') && user.processType === 'showcase') {
      const productIndex = parseInt(text.match(/‚Ññ(\d+)/)[1], 10) - 1;
      const product = await collectionProduct
        .find({ photo: { $exists: true } })
        .skip(productIndex)
        .limit(1)
        .toArray();

      if (!product.length) {
        await bot.sendMessage(chatId, '–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω.');
        return;
      }

      const selectedProduct = product[0];

         await collectionUser.updateOne(
        { userId },
        {
          $set: {
            selectedProduct,
            processType: "rules",
            price: selectedProduct.price,
            photo: selectedProduct.photo,
          },
        }
      );

      const chatId = msg.chat.id;
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();


      await bot.sendMessage(chatId, '–ë—É–∫–µ—Ç –≤—ã–±—Ä–∞–Ω!', {
        reply_markup: {
          keyboard: [['–ù–∞–∑–∞–¥']],
        },
      });


      await bot.sendMessage(chatId,"–ü—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –ª–∏ –≤—ã –Ω–∞—à—É  –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–Ω–¥–∏—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏",{reply_markup:{
        keyboard:[["–î–∞"],["–ù–µ—Ç"],["–û–∑–Ω–∞–∫–æ–º–∏—Ç—Å—è"]]
      }})
    } else if (user.processType === 'prepare_address') {
      if (text === '–°–∞–º–æ–≤—ã–≤–æ–∑') {
        const availableTimes = getAvailableShippingTime(user);
        console.log(availableTimes[0][0]);

        await bot.sendMessage(
          chatId,
          'üïí *–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è, –∫–æ–≥–¥–∞ –≤—ã –∑–∞–±–µ—Ä—ë—Ç–µ —Ç–æ–≤–∞—Ä.*\n\n' +
            `–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∏–∂–µ.`,
          {
            parse_mode: 'Markdown',
            reply_markup: {
              keyboard: [...availableTimes, ['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          }
        );
        setTimeout(async () => {
          await collectionUser.updateOne(
            { userId },
            {
              $set: {
                address: '–°–∞–º–æ–≤—ã–≤–æ–∑',
                MKAD: null,
                processType: 'select_time',
              },
            }
          );
        }, 700);
      } else if (text === '–í–≤–µ—Å—Ç–∏ –∞–¥—Ä–µ—Å') {
        await bot.sendMessage(chatId, '–£–∫–∞–∂–∏—Ç–µ, –∫–∞–∫—É—é –¥–æ—Å—Ç–∞–≤–∫—É –≤—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ?', {
          reply_markup: {
            keyboard: [
              ['–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –ú–æ—Å–∫–≤–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ú–ö–ê–î ‚Äî 750 ‚ÇΩ'],
              ['–ö—É—Ä—å–µ—Ä –∑–∞ –ú–ö–ê–î- –ë–ª–∏–∂–Ω–µ–µ –ü–æ–¥–º–æ—Å–∫–æ–≤—å–µ ‚Äî 950 ‚ÇΩ'],
              ['–ö—É—Ä—å–µ—Ä –∑–∞ –ú–ö–ê–î - –æ–±–ª–∞—Å—Ç—å ‚Äî 2000 ‚ÇΩ'],
            ],
          },
        });
      }
      // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª –ø—É—Ç—å —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å
      else if (
        text === '–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –ú–æ—Å–∫–≤–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ú–ö–ê–î ‚Äî 750 ‚ÇΩ' ||
        text === '–ö—É—Ä—å–µ—Ä –∑–∞ –ú–ö–ê–î- –ë–ª–∏–∂–Ω–µ–µ –ü–æ–¥–º–æ—Å–∫–æ–≤—å–µ ‚Äî 950 ‚ÇΩ' ||
        text === '–ö—É—Ä—å–µ—Ä –∑–∞ –ú–ö–ê–î - –æ–±–ª–∞—Å—Ç—å ‚Äî 2000 ‚ÇΩ'
      ) {
        await bot.sendMessage(
          chatId,
          '*–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –∞–¥—Ä–µ—Å –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:*\n\n' +
            '*–ì–æ—Ä–æ–¥, –£–ª–∏—Ü–∞, –î–æ–º* (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, —Å –±–æ–ª—å—à–æ–π –±—É–∫–≤—ã).\n\n' +
            '*–ü—Ä–∏–º–µ—Ä:*\n' +
            "'–ú–æ—Å–∫–≤–∞, –¢–≤–µ—Ä—Å–∫–∞—è —É–ª–∏—Ü–∞, 7'.",
          {
            parse_mode: 'Markdown',
            reply_markup: {
              keyboard: [['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          }
        );
        await collectionUser.updateOne({ userId }, { $set: { MKAD: text } });
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
        await collectionUser.updateOne(
          { userId },
          { $set: { isInProcess: true, processType: 'enter_address' } }
        );
      }
    } else if (user.processType === 'enter_address' && text !== '–ù–∞–∑–∞–¥') {
      const validationResponse = await validateAddress(text);
      console.log(validationResponse.message, validationResponse.valid);

      if (validationResponse.valid) {
        const availableTimes = getAvailableShippingTime(user);

        await bot.sendMessage(
          chatId,
          'üìç **–ê–¥—Ä–µ—Å –Ω–∞–π–¥–µ–Ω!**\n\n–¢–µ–ø–µ—Ä—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏. ‚è∞',
          {
            parse_mode: 'Markdown',
            reply_markup: {
              keyboard: [...availableTimes, ['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          }
        );
        await collectionUser.updateOne(
          { userId },
          { $set: { address: text, processType: 'select_time' } }
        );
      } else {
        await bot.sendMessage(
          chatId,
          '‚ùå **–ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–∏ÃÜ–¥–µ–Ω.**\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∞–¥—Ä–µ—Å ',
          {
            parse_mode: 'Markdown',
            reply_markup: {
              keyboard: [['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          }
        );
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
    } else if (
      (user.processType === 'select_time' && text === '9-11') ||
      (user.processType === 'select_time' && text === '12-14') ||
      (user.processType === 'select_time' && text === '15-17') ||
      (user.processType === 'select_time' && text === '18-20') ||
      (user.processType === 'select_time' &&
        text === '20-21' &&
        user.processType === 'select_time' &&
        text !== '–ù–∞–∑–∞–¥')
    ) {
      console.log(getAvailableShippingTime(user)[0][0], 'zzzww');

      if (
        getAvailableShippingTime(user)[0][0] === '–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –¥–æ—Å—Ç–∞–≤–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.'
      ) {
        console.log('can nto');

        return;
      }
      if (user.address === '–°–∞–º–æ–≤—ã–≤–æ–∑') {
        console.log(getAvailableShippingTime(user)[0][0], 'zzw');

        await bot.sendMessage(
          chatId,
          '‚è∞ **–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ –≤—ã–±—Ä–∞–Ω–æ.**\n\n–¢–µ–ø–µ—Ä—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞. üìû',
          {
            parse_mode: 'Markdown',
            reply_markup: {
              keyboard: [['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          }
        );
        await collectionUser.updateOne(
          { userId },
          { $set: { time: text, processType: 'client_number' } }
        );
        return;
      }

      await bot.sendMessage(
        chatId,
        '‚è∞ **–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ –≤—ã–±—Ä–∞–Ω–æ.**\n\n–¢–µ–ø–µ—Ä—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞. üìû',
        {
          parse_mode: 'Markdown',
          reply_markup: {
            keyboard: [['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        }
      );

      await collectionUser.updateOne(
        { userId },
        {
          $set: {
            time: text,
            processType: 'client_number',
          },
        }
      );
    } else if (user.processType === 'client_number' && text !== '–ù–∞–∑–∞–¥') {
      const phoneRegex = /^(\+7|8)\s?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{2}[\s.-]?\d{2}$/;
      if (!phoneRegex.test(text)) {
        await bot.sendMessage(
          chatId,
          '‚ùå **–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞.**\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑. üìû',
          {
            parse_mode: 'Markdown',
            reply_markup: {
              keyboard: [['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          }
        );
        return;
      }
      if (user.address === '–°–∞–º–æ–≤—ã–≤–æ–∑') {
        await bot.sendMessage(
          chatId,
          'üì± –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è —É—Å–ø–µ—à–Ω–æ –≤—ã–±—Ä–∞–Ω. \n\nüíå –°–µ–π—á–∞—Å, –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏, –≤—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∫–∏ –∏–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –¥–∞–ª—å—à–µ.',
          {
            parse_mode: 'Markdown',
            reply_markup: {
              keyboard: [['–ü–µ—Ä–µ–π—Ç–∏ –¥–∞–ª—å—à–µ'], ['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          }
        );
      } else {
        await bot.sendMessage(
          chatId,
          'üì±–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω. \n\n–¢–µ–ø–µ—Ä—å, —É–∫–∞–∂–∏—Ç–µ –∫—Ç–æ –ø–æ–ª—É—á–∏—Ç –∑–∞–∫–∞–∑ \n1Ô∏è‚É£  –Ø\n2Ô∏è‚É£ –î—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫\n\nüì± –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤. ',
          {
            parse_mode: 'Markdown',
            reply_markup: {
              keyboard: [['–Ø', '–î—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫'], ['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          }
        );
      }
      await collectionUser.updateOne(
        { userId },
        {
          $set: {
            clientNumber: text,
            processType: user.address === '–°–∞–º–æ–≤—ã–≤–æ–∑' ? 'postcard' : 'who_is_client',
          },
        }
      );
    } else if (
      user.processType === 'who_is_client' &&
      text !== '–ù–∞–∑–∞–¥' &&
      user.address !== '–°–∞–º–æ–≤—ã–≤–æ–∑'
    ) {
      if (text === '–Ø' || text === '1') {
        await bot.sendMessage(
          chatId,
          'üì±–í—ã —É–∫–∞–∑–∞–ª–∏ —Å–µ–±—è –∫–∞–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª—è. \n\nüíå –°–µ–π—á–∞—Å, –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏, –≤—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∫–∏ –∏–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –¥–∞–ª—å—à–µ.',
          {
            parse_mode: 'Markdown',
            reply_markup: {
              keyboard: [['–ü–µ—Ä–µ–π—Ç–∏ –¥–∞–ª—å—à–µ'], ['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          }
        );
        await collectionUser.updateOne(
          { userId },
          {
            $set: {
              whoIsClient: text,
              processType: 'postcard',
            },
          }
        );
      } else if (text === '–î—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫' || text === '2') {
        await bot.sendMessage(
          chatId,
          'üì±–í—ã —É–∫–∞–∑–∞–ª–∏ –¥—Ä—É–≥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –∫–∞–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª—è. \n\n–£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —ç—Ç–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ üìû',
          {
            parse_mode: 'Markdown',
            reply_markup: {
              keyboard: [[''], ['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          }
        );
        await collectionUser.updateOne(
          { userId },
          {
            $set: {
              whoIsClient: text,
              processType: 'recipient_number',
            },
          }
        );
      }
    } else if (user.processType === 'recipient_number' && text !== '–ù–∞–∑–∞–¥') {
      const phoneRegex = /^(\+7|8)\s?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{2}[\s.-]?\d{2}$/;
      if (!phoneRegex.test(text)) {
        await bot.sendMessage(
          chatId,
          '‚ùå **–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞.**\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑. üìû',
          {
            parse_mode: 'Markdown',
            reply_markup: {
              keyboard: [['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          }
        );
        return;
      }
      console.log('EXTRA INFORMATION');

      await bot.sendMessage(
        chatId,
        'üì± –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è —É—Å–ø–µ—à–Ω–æ –≤—ã–±—Ä–∞–Ω. \n\nüíå –°–µ–π—á–∞—Å, –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏, –≤—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∫–∏ –∏–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –¥–∞–ª—å—à–µ.',
        {
          parse_mode: 'Markdown',
          reply_markup: {
            keyboard: [['–ü–µ—Ä–µ–π—Ç–∏ –¥–∞–ª—å—à–µ'], ['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        }
      );
      await collectionUser.updateOne(
        { userId },
        { $set: { recipientNumber: text, processType: 'postcard' } }
      );
    } else if (user.processType === 'postcard' && text !== '–ù–∞–∑–∞–¥' && text === '–ü–µ—Ä–µ–π—Ç–∏ –¥–∞–ª—å—à–µ') {
      await bot.sendMessage(
        chatId,
        '–°–µ–π—á–∞—Å –≤—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ. ‚ú®',
        {
          parse_mode: 'Markdown',
          reply_markup: {
            keyboard: [['–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ'], ['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        }
      );
      await collectionUser.updateOne(
        { userId },
        { $set: { postcard: null, processType: 'extra_information' } }
      );
    } else if (user.processType === 'postcard' && text !== '–ù–∞–∑–∞–¥' && text !== '–ü–µ—Ä–µ–π—Ç–∏ –¥–∞–ª—å—à–µ') {
      await bot.sendMessage(
        chatId,
        '‚ú®–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞. –°–µ–π—á–∞—Å –≤—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ. ‚ú® ',
        {
          parse_mode: 'Markdown',
          reply_markup: {
            keyboard: [['–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ'], ['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        }
      );
      await collectionUser.updateOne(
        { userId },
        { $set: { postcard: text, processType: 'extra_information' } }
      );
    } else if (
      user.processType === 'extra_information' &&
      text !== '–ù–∞–∑–∞–¥' &&
      text !== '–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ'
    ) {
      await bot.sendMessage(
        chatId,
        '‚ú® –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –æ–ø–ª–∞—Ç–µ. ‚ú®',
        {
          parse_mode: 'Markdown',
          reply_markup: {
            keyboard: [[' –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ'], [' –ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        }
      );
      await collectionUser.updateOne(
        { userId },
        { $set: { extraInformation: text, processType: 'prepare_payment' } }
      );
    } else if (
      user.processType === 'extra_information' &&
      text === '–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ' &&
      text !== '–ù–∞–∑–∞–¥'
    ) {
      const merchantLogin = 'FloriMondibot';
      const password1 = 'lLj8x1UR4zvz7M7WezHS';
      const invId = Math.floor(100000 + Math.random() * 900000);

      const extraPrice =
        user && (await user.MKAD) === '–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –ú–æ—Å–∫–≤–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ú–ö–ê–î ‚Äî 750 ‚ÇΩ'
          ? 750
          : user.MKAD === '–ö—É—Ä—å–µ—Ä –∑–∞ –ú–ö–ê–î- –ë–ª–∏–∂–Ω–µ–µ –ü–æ–¥–º–æ—Å–∫–æ–≤—å–µ ‚Äî 950 ‚ÇΩ'
          ? 950
          : user.MKAD === '–ö—É—Ä—å–µ—Ä –∑–∞ –ú–ö–ê–î - –æ–±–ª–∞—Å—Ç—å ‚Äî 2000 ‚ÇΩ'
          ? 2000
          : 0;
      const outSum = (await user.price) + extraPrice;

      const link = await generatePaymentLink(merchantLogin, password1, invId, outSum);

      console.log(link);

      await collectionUser.updateOne({ userId }, { $set: { invId, processType: 'payment' } });
      // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Å—ã–ª–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
      await bot.sendMessage(
        chatId,
        `üí≥ *–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞* üí≥\n\n` +
          `üì¶ –¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞: *${await user.price}‚ÇΩ*\n` +
          `üöö –¶–µ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏: *${extraPrice}‚ÇΩ*\n` +
          `üí∞ –§–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ —Å —É—á–µ—Ç–æ–º –¥–æ—Å—Ç–∞–≤–∫–∏: *${outSum}‚ÇΩ*\n\n` +
          `[üí∞ –û–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑](${link})\n\n` + // –°–∫—Ä—ã—Ç–∞—è —Å—Å—ã–ª–∫–∞
          `‚úÖ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –≤–∞—à –∑–∞–∫–∞–∑ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.`,
        {
          parse_mode: 'Markdown',
          reply_markup: {
            keyboard: [['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        }
      );
    } else if (
      user.processType === 'prepare_payment' &&
      text === '–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ' &&
      text !== '–ù–∞–∑–∞–¥'
    ) {
      const merchantLogin = 'FloriMondibot';
      const password1 = 'lLj8x1UR4zvz7M7WezHS';
      const invId = Math.floor(100000 + Math.random() * 900000);

      const extraPrice =
        user && (await user.MKAD) === '–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –ú–æ—Å–∫–≤–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ú–ö–ê–î ‚Äî 750 ‚ÇΩ'
          ? 750
          : user.MKAD === '–ö—É—Ä—å–µ—Ä –∑–∞ –ú–ö–ê–î- –ë–ª–∏–∂–Ω–µ–µ –ü–æ–¥–º–æ—Å–∫–æ–≤—å–µ ‚Äî 950 ‚ÇΩ'
          ? 950
          : user.MKAD === '–ö—É—Ä—å–µ—Ä –∑–∞ –ú–ö–ê–î - –æ–±–ª–∞—Å—Ç—å ‚Äî 2000 ‚ÇΩ'
          ? 2000
          : 0;
      const outSum = (await user.price) + extraPrice;

      const link = await generatePaymentLink(merchantLogin, password1, invId, outSum);

      console.log(link);

      // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Å—ã–ª–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
      await bot.sendMessage(
        chatId,
        `üí≥ *–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞* üí≥\n\n` +
          `üì¶ –¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞: *${await user.price}‚ÇΩ*\n` +
          `üöö –¶–µ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏: *${extraPrice}‚ÇΩ*\n` +
          `üí∞ –§–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ —Å —É—á–µ—Ç–æ–º –¥–æ—Å—Ç–∞–≤–∫–∏: *${outSum}‚ÇΩ*\n\n` +
          `[üí∞ –û–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑](${link})\n\n` + // –°–∫—Ä—ã—Ç–∞—è —Å—Å—ã–ª–∫–∞
          `‚úÖ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –≤–∞—à –∑–∞–∫–∞–∑ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.`,
        {
          parse_mode: 'Markdown',
          reply_markup: {
            keyboard: [['–ù–∞–∑–∞–¥']],
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        }
      );
      await collectionUser.updateOne({ userId }, { $set: { invId, processType: 'payment' } });
      return;
    } else if (text !== '–ù–∞–∑–∞–¥') {
      //   await bot.sendMessage(
      //     chatId,
      //     "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ –ø–æ–Ω–∏–º–∞—é —ç—Ç—É –∫–æ–º–∞–Ω–¥—É. –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫."
      //   );
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
  }
});

bot.on('message', async (msg) => {
  try {
    const chatId = msg.chat.id;
    const userId = msg.from.id;
    const text = msg.text;
    if (!collectionUser) {
      return;
    }
    const chatType = msg.chat.type; // 'private', 'group', 'supergroup'
    if (chatType === 'supergroup') {
      return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã –≤ –≥—Ä—É–ø–ø–µ
    }
    const user = await collectionUser.findOne({ userId });
    if (
      user &&
      user.isInProcess &&
      user.processType !== 'about' &&
      user.processType !== 'site' &&
      user.processType !== 'catalog' &&
      user.processType !== 'catalog_price=4000' &&
      user.processType !== 'catalog_price=8000' &&
      user.processType !== 'catalog_price=15000' &&
      user.processType !== 'map'
    ) {
      return;
    } else if (text === '–û –Ω–∞—Å') {
      await collectionUser.updateOne(
        { userId },
        { $set: { isInProcess: true, processType: 'about' } }
      );
      const text = `
‚ú® Flori Mondi ‚Äì –≤–∞—à –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π —Å–∞–ª–æ–Ω —Å –±–µ–∑—É–ø—Ä–µ—á–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º, –±—ã—Å—Ç—Ä—ã–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∞–º–∏ –∏ —Ä–æ—Å–∫–æ—à–Ω—ã–º –±—É—Ç–∏–∫–æ–º –≤ —Å–∞–º–æ–º —Å–µ—Ä–¥—Ü–µ –ú–æ—Å–∫–≤—ã.

üå∑ –ú—ã —Å–æ–∑–¥–∞–µ–º –Ω–µ –ø—Ä–æ—Å—Ç–æ –±—É–∫–µ—Ç—ã, –∞ –º–æ–º–µ–Ω—Ç—ã —Å—á–∞—Å—Ç—å—è, –≥–¥–µ –∫–∞–∂–¥—ã–π –ª–µ–ø–µ—Å—Ç–æ–∫ –ø—Ä–æ–ø–∏—Ç–∞–Ω –∑–∞–±–æ—Ç–æ–π. –ù–∞—à–∏ —Ñ–ª–æ—Ä–∏—Å—Ç—ã —Å–¥–µ–ª–∞–ª–∏ –≤—Å—ë, —á—Ç–æ–±—ã –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–∫–∞–∑–∞ —Å—Ç–∞–ª –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —É–¥–æ–±–Ω—ã–º –∏ –ø—Ä–∏—è—Ç–Ω—ã–º –¥–ª—è –≤–∞—Å.

üå∏ –° –Ω–∞–º–∏ –≤—ã –∑–∞–±—É–¥–µ—Ç–µ –æ –≤–æ–ª–Ω–µ–Ω–∏—è—Ö: —Å–≤–µ–∂–µ—Å—Ç—å —Ü–≤–µ—Ç–æ–≤, —Ç–æ—á–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –±–µ–∑—É–ø—Ä–µ—á–Ω–∞—è —Å–±–æ—Ä–∫–∞ ‚Äî —ç—Ç–æ –Ω–∞—à–∞ –∑–æ–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏. –ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –º—ã –≤—Å–µ–≥–¥–∞ —Å–æ–≥–ª–∞—Å—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤–∏–¥ –±—É–∫–µ—Ç–∞ —Å –≤–∞–º–∏ –∏ –≥–æ—Ç–æ–≤—ã —É—á–µ—Å—Ç—å –ª—é–±—ã–µ –≤–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è.

üíå –•–æ—Ç–∏—Ç–µ –ø–æ–ª–æ–∂–∏—Ç—å –∫ –±—É–∫–µ—Ç—É —à–æ–∫–æ–ª–∞–¥–∫—É, –ø–æ–¥–ø–∏—Å–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç–∫—É –∏–ª–∏ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ –∞–Ω–æ–Ω–∏–º–Ω–æ? –î–ª—è –Ω–∞—Å –Ω–µ—Ç –Ω–µ–≤—ã–ø–æ–ª–Ω–∏–º—ã—Ö –∑–∞–¥–∞—á! –ú—ã –≥–æ—Ä–¥–∏–º—Å—è —Ç–µ–º, —á—Ç–æ –º–æ–∂–µ–º –≤–æ–ø–ª–æ—â–∞—Ç—å –≤ –∂–∏–∑–Ω—å –¥–∞–∂–µ —Å–∞–º—ã–µ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –¥–æ–∫–∞–∑—ã–≤–∞—è –≤–∞–º, —á—Ç–æ –≤—ã–±–æ—Ä Flori Mondi ‚Äî —ç—Ç–æ –≤—Å–µ–≥–¥–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ.

üåü –ú—ã –∑–¥–µ—Å—å, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–∞–¥–æ—Å—Ç—å –¥–ª—è –≤–∞—Å –∏ –≤–∞—à–∏—Ö –±–ª–∏–∑–∫–∏—Ö.
`;
      await bot.sendMessage(chatId, text, {
        reply_markup: {
          keyboard: [['–ù–∞–∑–∞–¥']],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });
    } else if (text === '–ù–∞—à —Å–∞–π—Ç') {
      await collectionUser.updateOne(
        { userId },
        { $set: { isInProcess: true, processType: 'site' } }
      );

      await bot.sendMessage(chatId, 'www.florimondi.ru/about/', {
        reply_markup: {
          keyboard: [['–ù–∞–∑–∞–¥']],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });
    } else if (text === '–ù–∞—à –∫–∞—Ç–∞–ª–æ–≥') {
      const slidesFor4k = await collectionCategory.findOne({
        'categoryInfo.id': '1',
      });
      const slidesFor7k = await collectionCategory.findOne({
        'categoryInfo.id': '2',
      });
      const slidesFor10k = await collectionCategory.findOne({
        'categoryInfo.id': '3',
      });
      const slidesFor14k = await collectionCategory.findOne({
        'categoryInfo.id': '4',
      });
      await collectionUser.updateOne(
        { userId },
        { $set: { isInProcess: true, processType: 'catalog' } }
      );

      await bot.sendMessage(chatId, '–í—ã–±–µ—Ä–µ—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å –∫–∞—Ç–∞–ª–æ–≥ ', {
        reply_markup: {
          keyboard: [
            [slidesFor4k.categoryInfo.name, slidesFor7k.categoryInfo.name],
            [slidesFor14k.categoryInfo.name, slidesFor10k.categoryInfo.name],
            ['–ù–∞–∑–∞–¥'],
          ],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });
    } else if (text === '–ú—ã –Ω–∞ –∫–∞—Ä—Ç–µ') {
      await collectionUser.updateOne(
        { userId },
        { $set: { isInProcess: true, processType: 'map' } }
      );
      await bot.sendLocation(chatId, 55.743139, 37.633583);
      await bot.sendMessage(chatId, '–ú–æ—Å–∫–≤–∞, –†—É–Ω–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ—É–ª–æ–∫ 8, —Å—Ç—Ä–æ–µ–Ω–∏–µ 1', {
        reply_markup: {
          keyboard: [['–ù–∞–∑–∞–¥']],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });
    }
    const isFirst = await collectionCategory.findOne({
      'categoryInfo.id': '1',
      'categoryInfo.name': text,
    });

    const isSecond = await collectionCategory.findOne({
      'categoryInfo.id': '2',
      'categoryInfo.name': text,
    });
    const isThird = await collectionCategory.findOne({
      'categoryInfo.id': '3',
      'categoryInfo.name': text,
    });

    const isFourth = await collectionCategory.findOne({
      'categoryInfo.id': '4',
      'categoryInfo.name': text,
    });

    if (
      isFirst !== null ||
      (isFirst !== undefined && undefined && user.processType === 'catalog')
    ) {
      await collectionUser.updateOne(
        { userId },
        { $set: { isInProcess: true, processType: 'catalog_price=4000' } }
      );

      await bot.sendMessage(chatId, `–í—ã –≤—ã–±—Ä–∞–ª–∏ –∫–∞—Ç–∞–ª–æ–≥: ${isFirst.categoryInfo.name}`, {
        reply_markup: {
          keyboard: [['–ù–∞–∑–∞–¥']],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });

      // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞
      async function sendCatalog() {
        const slidesFor4k = await collectionCategory.findOne({
          'categoryInfo.id': '1',
        });
        console.log(slidesFor4k, '1');

        await slidesFor4k.categoryItem.forEach(async (item, index) => {
          const sentMessage = await bot.sendPhoto(chatId, item.photo, {
            caption: item.caption,
            parse_mode: 'Markdown',
            reply_markup: {
              inline_keyboard: [
                [
                  {
                    text: 'üõí –ö—É–ø–∏—Ç—å',
                    callback_data: `vitrina_4k_${item.itemId}`,
                  },
                ],
              ],
            },
          });
          await collectionUser.updateOne(
            { userId },
            { $push: { photo_to_delete: sentMessage.message_id } }
          );
        });
      }

      await sendCatalog();
    }
    if (isSecond !== null && isSecond !== undefined && user.processType === 'catalog') {
      await collectionUser.updateOne(
        { userId },
        { $set: { isInProcess: true, processType: 'catalog_price=8000' } }
      );
      await bot.sendMessage(chatId, `–í—ã –≤—ã–±—Ä–∞–ª–∏ –∫–∞—Ç–∞–ª–æ–≥: ${isSecond.categoryInfo.name}`, {
        reply_markup: {
          keyboard: [['–ù–∞–∑–∞–¥']],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });
      async function sendCatalog() {
        const slidesFor7k = await collectionCategory.findOne({
          'categoryInfo.id': '2',
        });
        slidesFor7k.categoryItem.forEach(async (item, index) => {
          const sentMessage = await bot.sendPhoto(chatId, item.photo, {
            caption: item.caption,
            parse_mode: 'Markdown',
            reply_markup: {
              inline_keyboard: [
                [
                  {
                    text: 'üõí –ö—É–ø–∏—Ç—å',
                    callback_data: `vitrina_7k_${item.itemId}`,
                  },
                ],
              ],
            },
          });
          await collectionUser.updateOne(
            { userId },
            { $push: { photo_to_delete: sentMessage.message_id } }
          );
        });
      }

      await sendCatalog();
    }
    if (isThird !== null && isThird !== undefined && user.processType === 'catalog') {
      await collectionUser.updateOne(
        { userId },
        { $set: { isInProcess: true, processType: 'catalog_price=10000' } }
      );
      await bot.sendMessage(chatId, `–í—ã –≤—ã–±—Ä–∞–ª–∏ –∫–∞—Ç–∞–ª–æ–≥: ${isThird.categoryInfo.name}`, {
        reply_markup: {
          keyboard: [['–ù–∞–∑–∞–¥']],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });
      async function sendCatalog() {
        const slidesFor10k = await collectionCategory.findOne({
          'categoryInfo.id': '3',
        });
        slidesFor10k.categoryItem.forEach(async (item, index) => {
          const sentMessage = await bot.sendPhoto(chatId, item.photo, {
            caption: item.caption,
            parse_mode: 'Markdown',
            reply_markup: {
              inline_keyboard: [
                [
                  {
                    text: 'üõí –ö—É–ø–∏—Ç—å',
                    callback_data: `vitrina_10k_${item.itemId}`,
                  },
                ],
              ],
            },
          });
          await collectionUser.updateOne(
            { userId },
            { $push: { photo_to_delete: sentMessage.message_id } }
          );
        });
      }
      await sendCatalog();
    } else if (isFourth !== null && isFourth !== undefined && user.processType === 'catalog') {
      await collectionUser.updateOne(
        { userId },
        { $set: { isInProcess: true, processType: 'catalog_price=10000++' } }
      );
      await bot.sendMessage(chatId, `–í—ã –≤—ã–±—Ä–∞–ª–∏ –∫–∞—Ç–∞–ª–æ–≥: ${isFourth.categoryInfo.name}`, {
        reply_markup: {
          keyboard: [['–ù–∞–∑–∞–¥']],
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });
      async function sendCatalog() {
        const slidesFor10moreK = await collectionCategory.findOne({
          'categoryInfo.id': '4',
        });
        slidesFor10moreK.categoryItem.forEach(async (item, index) => {
          const sentMessage = await bot.sendPhoto(chatId, item.photo, {
            caption: item.caption,
            parse_mode: 'Markdown',
            reply_markup: {
              inline_keyboard: [
                [
                  {
                    text: 'üõí –ö—É–ø–∏—Ç—å',
                    callback_data: `vitrina_14k_${item.itemId}`,
                  },
                ],
              ],
            },
          });
          await collectionUser.updateOne(
            { userId },
            { $push: { photo_to_delete: sentMessage.message_id } }
          );
        });
      }
      await sendCatalog();
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
  }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è

bot.on('callback_query', async (query) => {
  try {
    if (!collectionUser) {
      return;
    }
    const user = await collectionUser.findOne({ userId: query.from.id });
    if (!user) {
      return;
    }
    const chatId = query.message.chat.id;
    const callback_data = query.data;

    if (callback_data.includes('update_category')) {
      try {
        const itemId = callback_data.split('_')[2];

        const foundedCategory = await collectionCategory.findOne({
          'categoryItem.itemId': itemId,
        });
        const foundedItem = foundedCategory.categoryItem.find((item) => item.itemId === itemId);

        bot.sendMessage(
          chatId,
          `–í—ã –≤—ã–±—Ä–∞–ª–∏ —Ç–æ–≤–∞—Ä: ${foundedItem.caption}\n\n–¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ `
        );
        await collectionUser.updateOne(
          { userId: query.from.id },
          {
            $set: {
              isInProcess: true,
              step: 'getCategoryPhoto',
              itemId: foundedItem.itemId,
              processType: 'update_category_photo',
            },
          }
        );
        console.log('category', itemId, foundedItem);
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ callback_query:', error);
      }
    }

    if (callback_data === 'nextt_product_10') {
      const products = await collectionProduct.find({ photo: { $exists: true } }).toArray();
      const count = products.length;

      if (user.photo_to_delete) {
        console.log('—É–¥–∞–ª–µ–Ω–∏–µ –Ω–∞ –∑–∞—Ö–æ–¥–µ 2');

        await user.photo_to_delete.forEach(async (photoId) => {
          await bot.deleteMessage(chatId, photoId);
        });
      }

      if (Array.isArray(user.message_to_delete) && user.message_to_delete.length > 0) {
        for (const messageId of user.message_to_delete) {
          try {
            await bot.deleteMessage(chatId, messageId);
          } catch (error) {
            console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è2 ${messageId}:`, error.message);
          }
        }
      } else if (typeof user.message_to_delete === 'number') {
        try {
          await bot.deleteMessage(chatId, user.message_to_delete);
        } catch (error) {
          console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è2 ${user.message_to_delete}:`, error.message);
        }
      }

      await collectionUser.updateOne(
        { userId: query.from.id },
        { $set: { message_to_delete: [] } }
      );
      // –°–ª–∞–π–¥ 10-20 —Ç–æ–≤–∞—Ä–æ–≤
      const mediaGroup = await products
        .filter((product) => product.photo)
        .map((product, index) => ({
          type: 'photo',
          media: product.photo,
          caption: `‚Ññ${index + 11}: ${product.price || '–ë–µ–∑ —Ü–µ–Ω—ã'} ‚ÇΩ`,
        }))
        .slice(10, 20);
      const keyboardText = await products
        .slice(10, 20)
        .map((product, index) => [
          `‚Ññ${index + 11} ${product.price ? `${product.price} ‚ÇΩ` : '–ë–µ–∑ —Ü–µ–Ω—ã'}`,
        ]);
      keyboardText.push(['–ù–∞–∑–∞–¥']);
      const messagePhotos = await bot.sendMediaGroup(chatId, mediaGroup);
      const messagePhotoId = messagePhotos.map((item) => item.message_id);

      const keyboard = [
        {
          text: '–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Å–ª–∞–π–¥',
          callback_data: 'back_from_showcase',
        },
        {
          text: '–°–º–æ—Ç—Ä–µ—Ç—å –¥–∞–ª—å—à–µ',
          callback_data: 'nextt_product_20',
        },
      ];
      const keyboard2 = [
        {
          text: '–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Å–ª–∞–π–¥',
          callback_data: 'back_from_showcase',
        },
      ];
      const messagesId = [];
      const messageWelcome = await bot.sendMessage(chatId, '–í—ã –ø–µ—Ä–µ—à–ª–∏ –Ω–∞ –≤—Ç–æ—Ä–æ–π —Å–ª–∞–π–¥.', {
        reply_markup: {
          keyboard: keyboardText,
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });
      messagesId.push(messageWelcome.message_id);
      if (count >= 21) {
        const messageWelcome2 = await bot.sendMessage(
          chatId,
          '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–ª–∞–π–¥—É:',
          {
            reply_markup: {
              inline_keyboard: [keyboard],
            },
          }
        );
        messagesId.push(messageWelcome2.message_id);
      }

      if (count < 21) {
        const messageWelcome2 = await bot.sendMessage(
          chatId,
          '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Å–ª–∞–π–¥—É:',
          {
            reply_markup: {
              inline_keyboard: [keyboard2],
            },
          }
        );
        messagesId.push(messageWelcome2.message_id);
      }

      await collectionUser.updateOne(
        { userId: chatId },
        {
          $set: {
            currentShow: 2,
            photo_to_delete: messagePhotoId,
            message_to_delete: messagesId,
          },
        }
      );
      return;
    }
    if (callback_data === 'nextt_product_20') {
      if (user.photo_to_delete) {
        await user.photo_to_delete.forEach(async (photoId) => {
          await bot.deleteMessage(chatId, photoId);
          await collectionUser.updateOne({ userId: chatId }, { $set: { photo_to_delete: [] } });
        });
      }
      const products = await collectionProduct.find({ photo: { $exists: true } }).toArray();

      if (!user.message_to_delete) {
        console.log('message_to_delete –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω');
        return;
      }
      if (Array.isArray(user.message_to_delete) && user.message_to_delete.length > 0) {
        for (const messageId of user.message_to_delete) {
          try {
            await bot.deleteMessage(chatId, messageId);
          } catch (error) {
            console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è ${messageId}:`, error.message);
          }
        }
      } else if (typeof user.message_to_delete === 'number') {
        try {
          await bot.deleteMessage(chatId, user.message_to_delete);
        } catch (error) {
          console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è ${user.message_to_delete}:`, error.message);
        }
      }

      const keyboard = [
        {
          text: '–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Å–ª–∞–π–¥',
          callback_data: 'back_from_showcase',
        },
      ];

      await collectionUser.updateOne(
        { userId: chatId },
        {
          $set: {
            currentShow: 3,
            message_to_delete: [],
          },
        }
      );
      // –°–ª–∞–π–¥ 10-20 —Ç–æ–≤–∞—Ä–æ–≤
      const mediaGroup = await products
        .filter((product) => product.photo)
        .map((product, index) => ({
          type: 'photo',
          media: product.photo,
          caption: `‚Ññ${index + 11}: ${product.price || '–ë–µ–∑ —Ü–µ–Ω—ã'} ‚ÇΩ`,
        }))
        .slice(20, 30);
      const keyboardText = await products
        .slice(20, 30)
        .map((product, index) => [
          `‚Ññ${index + 21} ${product.price ? `${product.price} ‚ÇΩ` : '–ë–µ–∑ —Ü–µ–Ω—ã'}`,
        ]);
      keyboardText.push(['–ù–∞–∑–∞–¥']);

      const messagePhotos = await bot.sendMediaGroup(chatId, mediaGroup);
      const messageWelcome1 = await bot.sendMessage(chatId, '–í—ã –ø–µ—Ä–µ—à–ª–∏ –Ω–∞ —Ç—Ä–µ—Ç–∏–π —Å–ª–∞–π–¥.', {
        reply_markup: {
          keyboard: keyboardText,
          resize_keyboard: true,
          one_time_keyboard: true,
        },
      });
      const messageWelcome2 = await bot.sendMessage(chatId, '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –∏–ª–∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞–∑–∞–¥:', {
        reply_markup: {
          inline_keyboard: [keyboard],
        },
      });

      setTimeout(() => {
        collectionUser.updateOne(
          { userId: query.from.id },
          {
            $push: {
              photo_to_delete: {
                $each: messagePhotos.map((item) => item.message_id),
              },
            },
          }
        );
      }, 1000);

      const messagesId = [messageWelcome1.message_id, messageWelcome2.message_id];
      await collectionUser.updateOne(
        { userId: chatId },
        {
          $set: {
            message_to_delete: messagesId,
          },
        }
      );
      return;
    }
    if (callback_data === 'back_from_showcase') {
      if (user.currentShow === 2) {
        await collectionUser.updateOne(
          { userId: chatId },
          {
            $set: {
              currentShow: 1,
            },
          }
        );
        if (user.message_to_delete) {
          await user.message_to_delete.forEach(async (messageId) => {
            await bot.deleteMessage(chatId, messageId);
          });
        }

        if (user.photo_to_delete) {
          await user.photo_to_delete.forEach(async (photoId) => {
            await bot.deleteMessage(chatId, photoId);
            await collectionUser.updateOne({ userId: chatId }, { $set: { photo_to_delete: [] } });
          });
        }
        await collectionUser.updateOne(
          { userId: chatId },
          {
            $set: {
              message_to_delete: [],
            },
          }
        );
        const products = await collectionProduct.find({ photo: { $exists: true } }).toArray();

        if (products.length === 0) {
          await bot.sendMessage(chatId, '–ù–µ—Ç —Ñ–æ—Ç–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.');
          return;
        }

        const mediaGroup = products
          .filter((product) => product.photo)
          .map((product, index) => ({
            type: 'photo',
            media: product.photo,
            caption: `‚Ññ${index + 1}: ${product.price || '–ë–µ–∑ —Ü–µ–Ω—ã'} ‚ÇΩ`,
          }))
          .slice(0, 10);

        const messagePhotos = await bot.sendMediaGroup(chatId, mediaGroup);
        const messagePhotoId = messagePhotos.map((item) => item.message_id);
        console.log('messagePhotoId', messagePhotoId);

        await collectionUser.updateOne(
          { userId: chatId },
          {
            $set: {
              processType: 'showcase',
            },
          }
        );

        const keyboard = [
          {
            text: '–°–º–æ—Ç—Ä–µ—Ç—å –¥–∞–ª—å—à–µ',
            callback_data: 'nextt_product_10',
          },
        ];
        const keyboardText = products
          .slice(0, 10)
          .map((product, index) => [
            `‚Ññ${index + 1} ${product.price ? `${product.price} ‚ÇΩ` : '–ë–µ–∑ —Ü–µ–Ω—ã'}`,
          ]);
        keyboardText.push(['–ù–∞–∑–∞–¥']);
        const messageWelcome1 = await bot.sendMessage(chatId, '–í—ã –ø–µ—Ä–µ—à–ª–∏ –Ω–∞ –ø–µ—Ä–≤—ã–π —Å–ª–∞–π–¥.', {
          reply_markup: {
            keyboard: keyboardText,
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        const messageWelcome2 = await bot.sendMessage(
          chatId,
          '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–ª–∞–π–¥—É:',
          {
            reply_markup: {
              inline_keyboard: [keyboard],
            },
          }
        );
        const messagesId = [messageWelcome1.message_id, messageWelcome2.message_id];
        await collectionUser.updateOne(
          { userId: chatId },
          {
            $set: {
              message_to_delete: messagesId,
              photo_to_delete: messagePhotoId,
            },
          }
        );
        return;
      }
      if (user.currentShow === 3) {
        await collectionUser.updateOne(
          { userId: chatId },
          {
            $set: {
              currentShow: 2,
            },
          }
        );
        if (user.photo_to_delete) {
          await user.photo_to_delete.forEach(async (photoId) => {
            await bot.deleteMessage(chatId, photoId);
            await collectionUser.updateOne({ userId: chatId }, { $set: { photo_to_delete: [] } });
          });
        }
        if (user.message_to_delete) {
          await user.message_to_delete.forEach(async (messageId) => {
            await bot.deleteMessage(chatId, messageId);
          });
        }

        await collectionUser.updateOne(
          { userId: chatId },
          {
            $set: {
              message_to_delete: [],
            },
          }
        );
        const products = await collectionProduct.find({ photo: { $exists: true } }).toArray();

        if (products.length === 0) {
          await bot.sendMessage(chatId, '–ù–µ—Ç —Ñ–æ—Ç–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.');
          return;
        }

        const mediaGroup = await products
          .filter((product) => product.photo)
          .map((product, index) => ({
            type: 'photo',
            media: product.photo,
            caption: `‚Ññ${index + 11}: ${product.price || '–ë–µ–∑ —Ü–µ–Ω—ã'} ‚ÇΩ`,
          }))
          .slice(10, 20);

        const messagePhotos = await bot.sendMediaGroup(chatId, mediaGroup);
        console.log(
          'messagePhotos',
          messagePhotos.map((item) => item.message_id)
        );
        const photoIds = messagePhotos.map((item) => item.message_id);
        await collectionUser.updateOne(
          { userId: chatId },
          {
            $set: {
              processType: 'showcase',
            },
            $push: {
              photo_to_delete: { $each: photoIds },
            },
          }
        );

        const keyboard = [
          {
            text: '–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Å–ª–∞–π–¥',
            callback_data: 'back_from_showcase',
          },
          {
            text: '–°–º–æ—Ç—Ä–µ—Ç—å –¥–∞–ª—å—à–µ',
            callback_data: 'nextt_product_10',
          },
        ];
        const keyboardText = await products
          .slice(10, 20)
          .map((product, index) => [
            `‚Ññ${index + 11} ${product.price ? `${product.price} ‚ÇΩ` : '–ë–µ–∑ —Ü–µ–Ω—ã'}`,
          ]);
        keyboardText.push(['–ù–∞–∑–∞–¥']);
        const messageWelcome1 = await bot.sendMessage(chatId, '–í—ã –ø–µ—Ä–µ—à–ª–∏ –Ω–∞ –≤—Ç–æ—Ä–æ–π —Å–ª–∞–π–¥.', {
          reply_markup: {
            keyboard: keyboardText,
            resize_keyboard: true,
            one_time_keyboard: true,
          },
        });
        const messageWelcome2 = await bot.sendMessage(
          chatId,
          '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–ª–∞–π–¥—É:',
          {
            reply_markup: {
              inline_keyboard: [keyboard],
            },
          }
        );
        const messagesId = [messageWelcome1.message_id, messageWelcome2.message_id];
        await collectionUser.updateOne(
          { userId: chatId },
          {
            $set: {
              message_to_delete: messagesId,
            },
          }
        );
        return;
      }
    }
    console.log('callback_data', callback_data);

    if (
      callback_data.startsWith('date_') ||
      callback_data.startsWith('prev_') ||
      callback_data.startsWith('next_') ||
      callback_data === 'ignore'
    ) {
      if (callback_data.startsWith('date_')) {
        const rawDate = callback_data.split('_')[1]; // "2025-02-06"

        // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –≥–æ–¥, –º–µ—Å—è—Ü, –¥–µ–Ω—å
        const [year, month, day] = rawDate.split('-');

        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ DD.MM.YYYY
        const formattedMonth = String(month).padStart(2, '0');
        const formattedDay = String(day).padStart(2, '0');
        console.log(formattedDay, formattedMonth, year);

        const formattedDate = `${formattedDay}.${formattedMonth}.${year}`;
        await bot.sendMessage(
          chatId,
          `–í—ã –≤—ã–±—Ä–∞–ª–∏ –¥–∞—Ç—É: *${formattedDate}*. –¢–µ–ø–µ—Ä—å —É–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏. –í—ã –º–æ–∂–µ—Ç–µ –≤–≤–µ—Å—Ç–∏ –µ–≥–æ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:\n\n` +
            `1Ô∏è‚É£ *–í–≤–µ—Å—Ç–∏ –∞–¥—Ä–µ—Å:* –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∞–¥—Ä–µ—Å –≤ —Ñ–æ—Ä–º–∞—Ç–µ: *–ì–æ—Ä–æ–¥, –£–ª–∏—Ü–∞, –î–æ–º* (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ú–æ—Å–∫–≤–∞, –¢–≤–µ—Ä—Å–∫–∞—è —É–ª–∏—Ü–∞, 7). \n\n` +
            `‚ÑπÔ∏è *–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:* –ú—ã –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ–º –¥–æ—Å—Ç–∞–≤–∫—É —Ç–æ–ª—å–∫–æ –≤ –ú–æ—Å–∫–≤–µ –∏ –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏.\n\n` +
            `2Ô∏è‚É£ *–°–∞–º–æ–≤—ã–≤–æ–∑*: –í—ã –º–æ–∂–µ—Ç–µ –∑–∞–±—Ä–∞—Ç—å —Ç–æ–≤–∞—Ä —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Å –Ω–∞—à–µ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É –ú–æ—Å–∫–≤–∞, –†—É–Ω–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ—É–ª–æ–∫ 8, —Å—Ç—Ä–æ–µ–Ω–∏–µ 1.\n` +
            `–î–ª—è –≤—ã–±–æ—Ä–∞ —ç—Ç–æ–π –æ–ø—Ü–∏–∏ –Ω–∞–∂–º–∏—Ç–µ "–°–∞–º–æ–≤—ã–≤–æ–∑", –∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Å–∞–º–æ–≤—ã–≤–æ–∑–∞.\n\n`,
          {
            parse_mode: 'Markdown',
            reply_markup: {
              keyboard: [['–í–≤–µ—Å—Ç–∏ –∞–¥—Ä–µ—Å', '–°–∞–º–æ–≤—ã–≤–æ–∑'], ['–ù–∞–∑–∞–¥']],
              resize_keyboard: true,
              one_time_keyboard: true,
            },
          }
        );

        bot.deleteMessage(chatId, query.message.message_id);
        await collectionUser.updateOne(
          { userId: chatId },
          {
            $set: {
              selectedDate: formattedDate,
              processType: 'prepare_address',
              message_to_delete: null,
            },
          }
        );
      } else if (callback_data.startsWith('prev_') || callback_data.startsWith('next_')) {
        const [action, year, month] = callback_data.split('_');
        let newYear = parseInt(year);
        let newMonth = parseInt(month);

        if (action === 'prev') {
          newMonth -= 1;
          if (newMonth < 0) {
            newMonth = 11;
            newYear -= 1;
          }
        } else if (action === 'next') {
          newMonth += 1;
          if (newMonth > 11) {
            newMonth = 0;
            newYear += 1;
          }
        }

        const calendar = generateCalendar(newYear, newMonth);

        await bot.editMessageReplyMarkup(
          {
            inline_keyboard: calendar,
          },

          {
            chat_id: chatId,
            message_id: query.message.message_id,
          }
        );
        await collectionUser.updateOne(
          { userId: chatId },
          {
            $set: {
              message_to_delete: query.message.message_id,
            },
          }
        );
      } else if (callback_data === 'ignore') {
        bot.answerCallbackQuery(query.id, {
          text: '–≠—Ç–∞ –¥–∞—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞.',
        });
      }

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–≤–æ–¥ –∞–¥—Ä–µ—Å–∞
    }

    //VITRINAA
    const vitrinaData = parseCallbackData(callback_data);

    if (!vitrinaData) return;
    if (vitrinaData.price === '4') {
      const selectedProduct = await collectionCategory.findOne({
        'categoryInfo.id': '1',
        'categoryItem.itemId': vitrinaData.id,
      });

      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();

      const calendar = generateCalendar(year, month);

      const price = await selectedProduct.categoryItem
        .find((el) => el.itemId === vitrinaData.id)
        .caption.match(/–¶–µ–Ω–∞:\s*(.+)/);
      const photo = await selectedProduct.categoryItem.find((el) => el.itemId === vitrinaData.id)
        .photo;
      const numericPrice = await parseInt(price[1].replace(/\s|‚ÇΩ/g, ''), 10);
      if (user.message_to_delete) {
        await bot.deleteMessage(chatId, user.message_to_delete);
      }
      const sentMessage = await bot.sendMessage(
        chatId,
        'üìÖ–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—É—é –≤–∞–º –¥–∞—Ç—É:',
        {
          reply_markup: {
            inline_keyboard: calendar,
          },
        }
      );
      await collectionUser.updateOne(
        { userId: chatId },
        {
          $set: {
            isInProcess: true,
            processType: 'select_date',
            photo: photo,
            message_to_delete: sentMessage.message_id,
            price: numericPrice,
          },
        }
      );
    } else if (vitrinaData.price === '7') {
      const selectedProduct = await collectionCategory.findOne({
        'categoryInfo.id': '2',
        'categoryItem.itemId': vitrinaData.id,
      });

      console.log('vitrunamId', vitrinaData.id);

      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();

      const calendar = generateCalendar(year, month);

      const price = await selectedProduct.categoryItem
        .find((el) => el.itemId === vitrinaData.id)
        .caption.match(/–¶–µ–Ω–∞:\s*(.+)/);
      const numericPrice = await parseInt(price[1].replace(/\s|‚ÇΩ/g, ''), 10);

      const photo = await selectedProduct.categoryItem.find((el) => el.itemId === vitrinaData.id)
        .photo;

      if (user.message_to_delete) {
        await bot.deleteMessage(chatId, user.message_to_delete);
      }
      const sentMessage = await bot.sendMessage(
        chatId,
        'üìÖ–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—É—é –≤–∞–º –¥–∞—Ç—É:',
        {
          reply_markup: {
            inline_keyboard: calendar,
          },
        }
      );
      console.log('finally price,', numericPrice);

      await collectionUser.updateOne(
        { userId: chatId },
        {
          $set: {
            isInProcess: true,
            processType: 'select_date',
            photo: photo,
            message_to_delete: sentMessage.message_id,
            price: numericPrice,
          },
        }
      );
      console.log('selectedProduct', selectedProduct);
    } else if (vitrinaData.price === '10') {
      const selectedProduct = await collectionCategory.findOne({
        'categoryInfo.id': '3',
        'categoryItem.itemId': vitrinaData.id,
      });

      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();

      const calendar = generateCalendar(year, month);

      const price = await selectedProduct.categoryItem
        .find((el) => el.itemId === vitrinaData.id)
        .caption.match(/–¶–µ–Ω–∞:\s*(.+)/);
      const numericPrice = await parseInt(price[1].replace(/\s|‚ÇΩ/g, ''), 10);
      const photo = await selectedProduct.categoryItem.find((el) => el.itemId === vitrinaData.id)
        .photo;
      console.log('selectedProduct', selectedProduct);
      if (user.message_to_delete) {
        await bot.deleteMessage(chatId, user.message_to_delete);
      }

      const sentMessage = await bot.sendMessage(
        chatId,
        'üìÖ–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—É—é –≤–∞–º –¥–∞—Ç—É:',
        {
          reply_markup: {
            inline_keyboard: calendar,
          },
        }
      );
      await collectionUser.updateOne(
        { userId: chatId },
        {
          $set: {
            isInProcess: true,
            processType: 'select_date',
            photo: photo,
            message_to_delete: sentMessage.message_id,
            price: numericPrice,
          },
        }
      );
      console.log('selectedProduct', selectedProduct);
    } else if (vitrinaData.price === '14') {
      const selectedProduct = await collectionCategory.findOne({
        'categoryInfo.id': '4',
        'categoryItem.itemId': vitrinaData.id,
      });
      console.log('selectedProduct', selectedProduct);
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();

      const calendar = generateCalendar(year, month);

      const price = await selectedProduct.categoryItem
        .find((el) => el.itemId === vitrinaData.id)
        .caption.match(/–¶–µ–Ω–∞:\s*(.+)/);
      console.log('selectedProduct', selectedProduct);
      const photo = await selectedProduct.categoryItem.find((el) => el.itemId === vitrinaData.id)
        .photo;
      const numericPrice = await parseInt(price[1].replace(/\s|‚ÇΩ/g, ''), 10);
      if (user.message_to_delete) {
        await bot.deleteMessage(chatId, user.message_to_delete);
      }

      const sentMessage = await bot.sendMessage(
        chatId,
        'üìÖ–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—É—é –≤–∞–º –¥–∞—Ç—É:',
        {
          reply_markup: {
            inline_keyboard: calendar,
          },
        }
      );
      await collectionUser.updateOne(
        { userId: chatId },
        {
          $set: {
            isInProcess: true,
            processType: 'select_date',
            photo: photo,
            message_to_delete: sentMessage.message_id,
            price: numericPrice,
          },
        }
      );
    }
  } catch (e) {
    console.log(e);
  }
});

function parseCallbackData(callbackData) {
  const match = callbackData.match(/^vitrina_(\d+)\+?k_(\d+)$/);
  if (!match) return null;

  const price = match[1]; // –ó–Ω–∞—á–µ–Ω–∏–µ –º–µ–∂–¥—É vitrina_ –∏ _k
  const id = match[2]; // –ü–æ—Å–ª–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ

  return { price, id };
}

app.listen(3003, () => {
  console.log(`–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:${3004}`);
});
